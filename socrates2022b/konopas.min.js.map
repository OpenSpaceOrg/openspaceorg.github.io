{"version":3,"sources":["dist/konopas.js"],"names":["KonOpas","set","this","id","lc","tag_categories","default_duration","time_show_am_pm","abbrev_00_minutes","always_show_participants","max_items_per_page","non_ascii_people","people_per_screen","use_server","log_messages","cache_refresh_interval_mins","views","i","_log","i18n","txt","key","data","bind","translate_html","alert","Array","prototype","indexOf","filter","map","Date","now","window","store","Store","stars","Stars","server","Server","item","Item","info","Info","onhashchange","set_view","pl","document","getElementsByClassName","length","addEventListener","popup_open","_el","refresh_cache","msg","lvl","console","error","warn","log","getElementById","_new_elem","tag","cl","text","hide","e","createElement","className","textContent","style","display","G","en","n","c","d","k","Error","o","isNaN","v","p","l","other","s","Program","weekday_n","0","1","2","3","4","5","6","weekday_short_n","month_n","7","8","9","10","11","time_diff","true","search_example","no_ko_id","old_browser","item_not_found","item_tags","tags","track","type","star_export_this","star_export_share","star_import_this","star_import_diff","one","star_import_bad","star_set","add_n","discard_n","star_add","star_export_link","star_hint","star_no_memory","FFcookies","IOSprivate","filter_sum_id","filter_sum","undefined","day_link","hidden_link","server_cmd_fail","post_author","ical_login","ical_link","ical_hint","ical_make","login_why","set_program","list","opt","program","Prog","set_people","people","Part","view","location","hash","substr","tabs","classList","remove","add","show","body","t_interval","cache","applicationCache","status","UPDATEREADY","onclick","reload","UNCACHED","setInterval","update","lu","lu_time","self","cache_manifest","parentNode","getAttribute","protocol","x","XMLHttpRequest","onload","getResponseHeader","show_updated","open","send","toggle_collapse","span","getElementsByTagName","pretty_time_diff","title","toLocaleString","ev","event","target","tmp","innerHTML","list_click","scrollIntoView","navigator","userAgent","match","scroll","top","day","day_txt","t_el","s_el","times","onscroll","scroll_time","show_extra","html","a","konopas","el","ID","it","forEach","t","cat","tgt","split","shift","join","link","push","T","hash_encode","name","desc","extra","appendChild","new","_loc_str","loc","slice","mins","pretty_time","time","time_sum","frame","star","cloneNode","show_list","ls","_day_link","day_links","N","day_lengths","D","parse_date","getDay","scrollTo","_now","frag","createDocumentFragment","prev_date","prev_time","_list_item","date","show_all","hide_ended","t1","n_hidden","pretty_date","t0","setAttribute","n_listed","days","day_now","data_date","insertBefore","firstChild","LS","removeChild","expand_all","items","exp_txt","star_els","toggle","prog_view","d_s","d_n","d_click","li","dt","focus_day","d_set","div","len","ul","show_filter_sum","is_link","test","tagName","toLowerCase","href","S","st_len","scroll_top","pageYOffset","offsetTop","day0","day1","sortname","replace","make_ascii","sort","b","localeCompare","set_ranges","bin_size","_range_set","nr","startChar","charAt","name_range","participant","update_view","_firstletter","toUpperCase","fn","ln","ranges","ends","start","n_bins","Math","round","n_up","n_down","String","fromCharCode","charCodeAt","nl_type","name_in_range","n0","range","show_one","p_name","clean_name","links","img","clean_links","onLine","bio","prog","lp","p_id","ll","querySelectorAll","cmd","some","get","contains","hash_decode","pa","r","trim","Function","oThis","TypeError","aArgs","call","arguments","fToBind","fNOP","fBound","apply","concat","toLocaleDateString","_orig_toLocaleDateString","locale","options","w","getDate","m","getMonth","year","getFullYear","normalize","str","toString","norm_map","A","AA","AE","AO","AU","AV","AY","B","C","DZ","Dz","E","F","H","I","J","K","L","LJ","Lj","M","NJ","Nj","O","OI","OO","OU","P","Q","R","TZ","U","V","VY","W","X","Y","Z","aa","ae","ao","au","av","ay","dz","f","g","h","hv","j","lj","nj","oi","ou","oo","q","tz","u","vy","y","z","elemCtrProto","HTMLElement","Element","objCtr","Object","strTrim","arrIndexOf","DOMEx","message","code","DOMException","checkTokenAndGetIndex","token","ClassList","elem","trimmedClasses","classes","_updateClassName","classListProto","classListGetter","index","splice","defineProperty","classListPropDesc","enumerable","configurable","ex","number","__defineGetter__","_sort","Number","valueOf","pf","filter_change","nextElementSibling","sf","onsubmit","oninput","onreset","set_filters","init_filters","pt","preventDefault","excl","RegExp","get_filters","hash_only","filters","area","query","h_set","tag_re","hasOwnProperty","silent","history","replaceState","value","popups","day-sidebar","day-narrow","_d","_txt","_ul","_li","par","labels","regexp","_compare","af","_a","_b","bb","_ul2","prefix","root","_fill","promote","exclude","re","min_count","keys","categories","list_in","list_out","filter_el","areas","loc_level","t_s","set_category","d_re","d_d","short","long","fs","cb","unset","id_only","TITLE","disabled","ALL","tag_str","area_str","query_str","TAG","_filter","prev","glob_to_re","every","host","el_id","err_el_id","localStorage","VarStore","connected","getItem","ical","prog_data","prog_server_mtime","err_el","disconnect","exec","decodeURIComponent","logout","url","CMD","onmessage","origin","JSON","parse","cb_ok","prog_mtime","mtime","add_prog","add_star","set_prog","star_list","show_ical_link","p_el","A_TAG","i_el","encodeURIComponent","script","done","src","async","onerror","onreadystatechange","readyState","setItem","write","stringify","parseInt","cb_fail","cb_info","email","jsErrLog","cb_token","cb_login","cb_my_prog","sync","cb_my_votes","cb_pub_data","cb_show_comments","cb_ical_link","sessionStorage","read","QUOTA_EXCEEDED_ERR","floor","new_data","local_mod","redraw","server_add","server_rm","set_raw","set_len","stars_len","limit","WHY","SERVER","set_link","arrays_equal","THIS","SHORT","link_to_short_url","QR","link_to_qr_code","n_same","array_overlap","n_new","n_bad","PREV","NEW","SAME","BAD","URL","el_set","el_add","node","attr","pat","re_re","terms","removeItem","span_parts","ok","photo","fb","encodeURI","twitter","tw","which","src_el","pop_el","nextSibling","wrap_el","pop_title","getComputedStyle","getPropertyValue","pre0","_pretty_time","h12","getHours","getMinutes","abs","T_UNIT","T_PAST","day_str","weekday","month","t0_str","m_str"],"mappings":"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","file":"dist/konopas.min.js","sourcesContent":["/**\n * KonOpas -- http://konopas.org/ & https://github.com/eemeli/konopas\n * Copyright (c) 2013-2018 by Eemeli Aro <eemeli@gmail.com>\n * \n * Permission to use, copy, modify, and/or distribute this software for any\n * purpose with or without fee is hereby granted, provided that the above\n * copyright notice and this permission notice appear in all copies.\n * \n * The software is provided \"as is\" and the author disclaims all warranties\n * with regard to this software including all implied warranties of\n * merchantability and fitness. In no event shall the author be liable for\n * any special, direct, indirect, or consequential damages or any damages\n * whatsoever resulting from loss of use, data or profits, whether in an\n * action of contract, negligence or other tortious action, arising out of\n * or in connection with the use or performance of this software.\n * @license\n */\n\"use strict\";\n(function(G){G['i18n']={lc:{\"en\":function(n){return n===1?\"one\":\"other\"}},\nc:function(d,k){if(!d)throw new Error(\"MessageFormat: Data required for '\"+k+\"'.\")},\nn:function(d,k,o){if(isNaN(d[k]))throw new Error(\"MessageFormat: '\"+k+\"' isn't a number.\");return d[k]-(o||0)},\nv:function(d,k){i18n.c(d,k);return d[k]},\np:function(d,k,o,l,p){i18n.c(d,k);return d[k] in p?p[d[k]]:(k=i18n.lc[l](d[k]-o),k in p?p[k]:p.other)},\ns:function(d,k,p){i18n.c(d,k);return d[k] in p?p[d[k]]:p.other}}\ni18n[\"en\"]={\n\"Program\":function(d){return \"Programme\"},\n\"weekday_n\":function(d){return i18n.p(d,\"N\",0,\"en\",{\"0\":\"Sunday\",\"1\":\"Monday\",\"2\":\"Tuesday\",\"3\":\"Wednesday\",\"4\":\"Thursday\",\"5\":\"Friday\",\"6\":\"Saturday\",\"other\":\"???\"})},\n\"weekday_short_n\":function(d){return i18n.p(d,\"N\",0,\"en\",{\"0\":\"Sun\",\"1\":\"Mon\",\"2\":\"Tue\",\"3\":\"Wed\",\"4\":\"Thu\",\"5\":\"Fri\",\"6\":\"Sat\",\"other\":\"???\"})},\n\"month_n\":function(d){return i18n.p(d,\"N\",0,\"en\",{\"0\":\"January\",\"1\":\"February\",\"2\":\"March\",\"3\":\"April\",\"4\":\"May\",\"5\":\"June\",\"6\":\"July\",\"7\":\"August\",\"8\":\"September\",\"9\":\"October\",\"10\":\"November\",\"11\":\"December\",\"other\":\"???\"})},\n\"time_diff\":function(d){return i18n.v(d,\"T\")+\" \"+i18n.p(d,\"T_UNIT\",0,\"en\",{\"0\":\"seconds\",\"1\":\"minutes\",\"2\":\"hours\",\"3\":\"days\",\"4\":\"weeks\",\"5\":\"months\",\"6\":\"years\",\"other\":\"???\"})+\" \"+i18n.s(d,\"T_PAST\",{\"true\":\"ago\",\"other\":\"from now\"})},\n\"search_example\":function(d){return \"For example, you could try <b>\"+i18n.v(d,\"X\")+\"</b>\"},\n\"no_ko_id\":function(d){return \"No ID set! Please assign konopas_set.id a unique identifier.\"},\n\"old_browser\":function(d){return \"Unfortunately, your browser doesn't support some of the Javascript features required by KonOpas. To use, please try a different browser.\"},\n\"item_not_found\":function(d){return \"Programme id <b>\"+i18n.v(d,\"ID\")+\"</b> not found!\"},\n\"item_tags\":function(d){return i18n.s(d,\"T\",{\"tags\":\"Tags\",\"track\":\"Track\",\"type\":\"Type\",\"other\":i18n.v(d,\"T\")})},\n\"star_export_this\":function(d){return \"Your current selection is encoded in <a href=\\\"\"+i18n.v(d,\"THIS\")+\"\\\" target=\\\"_blank\\\">this page's URL</a>, which you may open elsewhere to share your selection.\"},\n\"star_export_share\":function(d){return \"For easier sharing, you can also generate a <a href=\\\"\"+i18n.v(d,\"SHORT\")+\"\\\">shorter link</a> or a <a href=\\\"\"+i18n.v(d,\"QR\")+\"\\\">QR code</a>.\"},\n\"star_import_this\":function(d){return \"Your previously selected items are shown with a highlighted interior, while those imported via <a href=\\\"\"+i18n.v(d,\"THIS\")+\"\\\">this link</a> have a highlighted border.\"},\n\"star_import_diff\":function(d){return \"Your previous selection \"+i18n.p(d,\"PREV\",0,\"en\",{\"0\":\"was empty\",\"one\":\"had one item\",\"other\":\"had \"+i18n.n(d,\"PREV\")+\" items\"})+\", and the imported selection has \"+i18n.p(d,\"NEW\",0,\"en\",{\"0\":\"no new items\",\"one\":\"one new item\",\"other\":i18n.n(d,\"NEW\")+\" new items\"})+\" \"+i18n.p(d,\"SAME\",0,\"en\",{\"0\":\"\",\"one\":\"and one which was already selected\",\"other\":\"and \"+i18n.n(d,\"SAME\")+\" which were already selected\"})+\".\"},\n\"star_import_bad\":function(d){return i18n.p(d,\"BAD\",0,\"en\",{\"0\":\"\",\"one\":\"One of the imported items had an invalid ID.\",\"other\":i18n.n(d,\"BAD\")+\" of the imported items had invalid IDs.\"})},\n\"star_set\":function(d){return \"Set my selection to the imported selection\"},\n\"add_n\":function(d){return \"add \"+i18n.v(d,\"N\")},\n\"discard_n\":function(d){return \"discard \"+i18n.v(d,\"N\")},\n\"star_add\":function(d){return \"Add the \"+i18n.p(d,\"N\",0,\"en\",{\"one\":\"new item\",\"other\":i18n.n(d,\"N\")+\" new items\"})+\" to my selection\"},\n\"star_export_link\":function(d){return \"<a href=\\\"\"+i18n.v(d,\"URL\")+\"\\\">Export selection</a> (\"+i18n.p(d,\"N\",0,\"en\",{\"one\":\"one item\",\"other\":i18n.n(d,\"N\")+\" items\"})+\")\"},\n\"star_hint\":function(d){return \"To \\\"star\\\" a programme item, click on the square next to it. Your selections will be remembered, and shown in this view. You currently don't have any programme items selected, so this list is empty.\"},\n\"star_no_memory\":function(d){return i18n.s(d,\"WHY\",{\"FFcookies\":\"It looks like you're using a Firefox browser with cookies disabled, so \",\"IOSprivate\":\"It looks like you're using an iOS or Safari browser in private mode, so \",\"other\":\"For some reason,\"})+\" your <a href=\\\"http://en.wikipedia.org/wiki/Web_storage\\\">localStorage</a> is not enabled, and therefore your selection will not be remembered between sessions. \"+i18n.s(d,\"SERVER\",{\"true\":\"Please <span class=\\\"js-link\\\" onclick=\\\"var e=_el('login-popup-link');if(e)e.click();\\\">login</span> to enable persistent storage.\",\"other\":\"\"})},\n\"filter_sum_id\":function(d){return \"Listing \"+i18n.p(d,\"N\",0,\"en\",{\"one\":\"one item: \"+i18n.v(d,\"TITLE\"),\"other\":i18n.n(d,\"N\")+\" items with id \"+i18n.v(d,\"ID\")})},\n\"filter_sum\":function(d){return \"Listing \"+i18n.p(d,\"N\",0,\"en\",{\"one\":\"one\",\"other\":i18n.v(d,\"ALL\")+\" \"+i18n.n(d,\"N\")})+\" \"+i18n.s(d,\"LIVE\",{\"undefined\":\"\",\"other\":\"current and future\"})+\" \"+i18n.v(d,\"TAG\")+\" \"+i18n.p(d,\"N\",0,\"en\",{\"one\":\"item\",\"other\":\"items\"})+\" \"+i18n.s(d,\"DAY\",{\"undefined\":\"\",\"other\":\"on \"+i18n.v(d,\"DAY\")+\" \"+i18n.s(d,\"TIME\",{\"undefined\":\"\",\"other\":\"after \"+i18n.v(d,\"TIME\")})})+\" \"+i18n.s(d,\"AREA\",{\"undefined\":\"\",\"other\":\"in \"+i18n.v(d,\"AREA\")})+\" \"+i18n.s(d,\"Q\",{\"undefined\":\"\",\"other\":\"matching the query \"+i18n.v(d,\"Q\")})},\n\"day_link\":function(d){return \"Show \"+i18n.v(d,\"N\")+\" matching items from \"+i18n.p(d,\"D\",0,\"en\",{\"0\":\"Sunday\",\"1\":\"Monday\",\"2\":\"Tuesday\",\"3\":\"Wednesday\",\"4\":\"Thursday\",\"5\":\"Friday\",\"6\":\"Saturday\",\"other\":\"???\"})},\n\"hidden_link\":function(d){return \"Show \"+i18n.v(d,\"N\")+\" more matching items with an end time before \"+i18n.v(d,\"T\")+\" on \"+i18n.p(d,\"D\",0,\"en\",{\"0\":\"Sunday\",\"1\":\"Monday\",\"2\":\"Tuesday\",\"3\":\"Wednesday\",\"4\":\"Thursday\",\"5\":\"Friday\",\"6\":\"Saturday\",\"other\":\"???\"})},\n\"server_cmd_fail\":function(d){return \"The command \\\"\"+i18n.v(d,\"CMD\")+\"\\\" failed.\"},\n\"post_author\":function(d){return i18n.v(d,\"N\")+\" posted\"},\n\"ical_login\":function(d){return \"To make your selection available in external calendars, please <span class=\\\"js-link\\\" onclick=\\\"var e=_el('login-popup-link');if(e)e.click();\\\">login</span>.\"},\n\"ical_link\":function(d){return \"Your selection is available as an iCal (.ics) calendar at:\"},\n\"ical_hint\":function(d){return \"Note that changes you make in this guide may not show up immediately in your external calendar software.\"},\n\"ical_make\":function(d){return \"To view your selection in your calendar app, you may also <br class=\\\"wide-only\\\">\"+i18n.v(d,\"A_TAG\")+\"make it available</a> in iCal (.ics) calendar format\"},\n\"login_why\":function(d){return \"Once you've verified your e-mail address, you'll be able to sync your data between different clients (including external calendars). After signing in, no information will be transmitted to these external services.\"}}\n})(this);\nfunction KonOpas(set) {\n\tthis.id = '';\n\tthis.lc = 'en';\n\tthis.tag_categories = false;\n\tthis.default_duration = 60;\n\tthis.time_show_am_pm = false;\n\tthis.abbrev_00_minutes = true; // only for am/pm time\n\tthis.always_show_participants = false;\n\tthis.max_items_per_page = 200;\n\tthis.non_ascii_people = false; // setting true enables correct but slower sort\n\tthis.people_per_screen = 100;\n\tthis.use_server = false;\n\tthis.log_messages = true;\n\tthis.cache_refresh_interval_mins = 60;\n\tthis.views = [ \"star\", \"prog\", \"part\", \"info\" ];\n\tif (typeof set == 'object') for (var i in set) this[i] = set[i];\n\n\tif (!this.log_messages) _log = function(){};\n\tif (i18n[this.lc]) {\n\t\ti18n.txt = function(key, data){ return key in i18n[this.lc] ? i18n[this.lc][key](data) : key; }.bind(this);\n\t\ti18n.translate_html(i18n[this.lc], 'data-txt');\n\t} else alert('Locale \"' + this.lc + '\" not found.');\n\tif (!this.id) alert(i18n.txt('no_ko_id'));\n\tif (!Array.prototype.indexOf || !Array.prototype.filter || !Array.prototype.map\n\t\t|| !Date.now || !('localStorage' in window)) alert(i18n.txt('old_browser'));\n\n\tthis.store = new KonOpas.Store(this.id);\n\tthis.stars = new KonOpas.Stars(this.id);\n\tthis.server = this.use_server && KonOpas.Server && new KonOpas.Server(this.id, this.stars);\n\tthis.item = new KonOpas.Item();\n\tthis.info = new KonOpas.Info();\n\twindow.onhashchange = this.set_view.bind(this);\n\tvar pl = document.getElementsByClassName('popup-link');\n\tfor (var i = 0; i < pl.length; ++i) pl[i].addEventListener('click', KonOpas.popup_open);\n\tif (_el('refresh')) window.addEventListener('load', this.refresh_cache.bind(this), false);\n}\n\nKonOpas.prototype.set_program = function(list, opt) { this.program = new KonOpas.Prog(list, opt); }\nKonOpas.prototype.set_people = function(list) { this.people = new KonOpas.Part(list, this); }\n\nKonOpas.prototype.set_view = function() {\n\tvar view = window.location.hash.substr(1, 4), tabs = _el('tabs');\n\tif (!this.program || !this.program.list.length) {\n\t\tview = 'info';\n\t\ttabs.style.display = 'none';\n\t\tthis.info.show();\n\t\tif (this.server) this.server.error('Programme loading failed!');\n\t} else {\n\t\ttabs.style.display = 'block';\n\t\tif (!this.people || !this.people.list.length) {\n\t\t\ttabs.classList.add('no-people');\n\t\t\tif (view == 'part') view = '';\n\t\t} else {\n\t\t\ttabs.classList.remove('no-people');\n\t\t}\n\t\tswitch (view) {\n\t\t\tcase 'part': this.people.show();  break;\n\t\t\tcase 'star': this.stars.show();   break;\n\t\t\tcase 'info': this.info.show();    break;\n\t\t\tdefault:     this.program.show(); view = 'prog';\n\t\t}\n\t}\n\tfor (var i = 0; i < this.views.length; ++i) {\n\t\tdocument.body.classList[view == this.views[i] ? 'add' : 'remove'](this.views[i]);\n\t}\n\tif (_el('load_disable')) _el('load_disable').style.display = 'none';\n}\n\nKonOpas.prototype.refresh_cache = function() {\n\tvar t_interval = this.cache_refresh_interval_mins * 60000,\n\t    cache = window.applicationCache;\n\tif (!t_interval || (t_interval < 0)) return;\n\tcache.addEventListener('updateready', function() {\n\t\tif (cache.status == cache.UPDATEREADY) {\n\t\t\t_el('refresh').classList.add('enabled');\n\t\t\t_el('refresh').onclick = function() { window.location.reload(); };\n\t\t}\n\t}, false);\n\tif (cache.status != cache.UNCACHED) {\n\t\twindow.setInterval(function() { cache.update(); }, t_interval);\n\t}\n}\nKonOpas.Info = function() {\n\tthis.lu = _el('last-updated');\n\tthis.lu_time = 0;\n\tvar self = this, cache_manifest = document.body.parentNode.getAttribute('manifest');\n\tif (this.lu && cache_manifest && ((location.protocol == 'http:') || (location.protocol == 'https:'))) {\n\t\tvar x = new XMLHttpRequest();\n\t\tx.onload = function() {\n\t\t\tself.lu_time = new Date(this.getResponseHeader(\"Last-Modified\"));\n\t\t\tself.show_updated();\n\t\t};\n\t\tx.open('GET', cache_manifest, true);\n\t\tx.send();\n\t}\n\tvar cl = _el('info_view').getElementsByClassName('collapse');\n\tfor (var i = 0; i < cl.length; ++i) {\n\t\tcl[i].onclick = KonOpas.toggle_collapse;\n\t}\n}\n\nKonOpas.Info.prototype.show_updated = function() {\n\tif (!this.lu || !this.lu_time) return;\n\tvar span = this.lu.getElementsByTagName('span')[0];\n\tspan.textContent = KonOpas.pretty_time_diff(this.lu_time);\n\tspan.title = this.lu_time.toLocaleString();\n\tspan.onclick = function(ev) {\n\t\tvar self = (ev || window.event).target;\n\t\tvar tmp = self.title;\n\t\tself.title = self.textContent;\n\t\tself.textContent = tmp;\n\t};\n\tthis.lu.style.display = 'inline';\n}\n\nKonOpas.Info.prototype.show = function() {\n\t_el(\"prog_ls\").innerHTML = \"\";\n\tthis.show_updated();\n}\n\nKonOpas.Item = function() {\n\t_el('prog_ls').onclick = KonOpas.Item.list_click;\n\tif (_el('scroll_link')) {\n\t\t_el('scroll_link').onclick = function() { _el('top').scrollIntoView(); return false; };\n\t\tif (window.navigator && navigator.userAgent.match(/Android [12]/)) {\n\t\t\t_el('time').style.display = 'none';\n\t\t\t_el('scroll').style.display = 'none';\n\t\t} else {\n\t\t\tthis.scroll = {\n\t\t\t\t'i': 0, 'top': 0,\n\t\t\t\t'day': '', 'day_txt': '',\n\t\t\t\t't_el': _el('time'), 's_el': _el('scroll'),\n\t\t\t\t'times': document.getElementsByClassName('new_time')\n\t\t\t};\n\t\t\twindow.onscroll = this.scroll_time.bind(this);\n\t\t}\n\t}\n}\n\nKonOpas.Item.show_extra = function(item, id) {\n\tfunction _tags(it) {\n\t\tif (!it.tags || !it.tags.length) return '';\n\t\tvar o = {};\n\t\tit.tags.forEach(function(t) {\n\t\t\tvar cat = 'tags';\n\t\t\tvar tgt = KonOpas.Prog.hash({'tag': t});\n\t\t\tvar a = t.split(':');\n\t\t\tif (a.length > 1) { cat = a.shift(); t = a.join(':'); }\n\t\t\tvar link = '<a href=\"' + tgt + '\">' + t + '</a>'\n\t\t\tif (o[cat]) o[cat].push(link);\n\t\t\telse o[cat] = [link];\n\t\t});\n\t\tvar a = []; for (var k in o) a.push(i18n.txt('item_tags', {'T':k}) + ': ' + o[k].join(', '));\n\t\treturn '<div class=\"discreet\">' + a.join('<br>') + '</div>\\n';\n\t}\n\tfunction _people(it) {\n\t\tif (!it.people || !it.people.length) return '';\n\t\tvar a = it.people.map(!konopas.people || !konopas.people.list.length\n\t\t\t? function(p) { return p.name; }\n\t\t\t: function(p) { return \"<a href=\\\"#part/\" + KonOpas.hash_encode(p.id) + \"\\\">\" + p.name + \"</a>\"; }\n\t\t);\n\t\treturn '<div class=\"item-people\">' + a.join(', ') + '</div>\\n';\n\t}\n\n\tif (_el(\"e\" + id)) return;\n\tvar html = \"\";\n\tvar a = konopas.program.list.filter(function(el) { return el.id == id; });\n\tif (a.length < 1) html = i18n.txt('item_not_found', {'ID':id});\n\telse {\n\t\thtml = _tags(a[0]) + _people(a[0]);\n\t\tif (a[0].desc) html += \"<p>\" + a[0].desc;\n\t\thtml += '<a href=\"#prog/id:' + a[0].id + '\" class=\"permalink\" title=\"' + i18n.txt('Permalink') + '\"></a>';\n\t}\n\tvar extra = _new_elem('div', 'extra');\n\textra.id = 'e' + id;\n\textra.innerHTML = html;\n\titem.appendChild(extra);\n}\n\nKonOpas.Item.new = function(it) {\n\tfunction _loc_str(it) {\n\t\tvar s = '';\n\t\tif (it.loc && it.loc.length) {\n\t\t\ts = it.loc[0];\n\t\t\tif (it.loc.length > 1) s += ' (' + it.loc.slice(1).join(', ') + ')';\n\t\t}\n\t\tif (it.mins && (it.mins != konopas.default_duration)) {\n\t\t\tif (s) s += ', ';\n\t\t\ts += KonOpas.pretty_time(it.time, konopas) + ' - ' + KonOpas.pretty_time(KonOpas.time_sum(it.time, it.mins), konopas);\n\t\t}\n\t\treturn s;\n\t}\n\tvar frame = _new_elem('div', 'item_frame'),\n\t    star  = frame.appendChild(_new_elem('div', 'item_star')),\n\t    item  = frame.appendChild(_new_elem('div', 'item')),\n\t    title = item.appendChild(_new_elem('div', 'title')),\n\t    loc   = item.appendChild(_new_elem('div', 'loc'));\n\n\tKonOpas.Item.new = function(it) {\n\t\tstar.id = 's' + it.id;\n\t\titem.id = 'p' + it.id;\n\t\ttitle.textContent = it.title;\n\t\tloc.textContent = _loc_str(it);\n\t\treturn frame.cloneNode(true);\n\t};\n\treturn KonOpas.Item.new(it);\n}\n\nKonOpas.Item.show_list = function(ls, opt) {\n\tvar\t_now = Date.now(),\n\t\tday_lengths = {}, day_links = {},\n\t\tfrag = document.createDocumentFragment(),\n\t\tprev_date = '', prev_time = '',\n\t\t_list_item = function(p) {\n\t\t\tif (opt.day && p.date) {\n\t\t\t\tday_lengths[p.date] = (day_lengths[p.date] || 0) + 1;\n\t\t\t}\n\t\t\tif (opt.show_all || !opt.day || !p.date || (p.date == opt.day)) {\n\t\t\t\tif (this.hide_ended && p.t1 && (p.t1 < opt.now)) { ++opt.n_hidden; return; }\n\t\t\t\tif (p.date != prev_date) {\n\t\t\t\t\tprev_date = p.date;\n\t\t\t\t\tprev_time = '';\n\t\t\t\t\tfrag.appendChild(_new_elem('div', 'new_day', KonOpas.pretty_date(p.t0 || p.date, konopas))).id = 'dt_' + p.date;\n\t\t\t\t}\n\t\t\t\tif (p.time != prev_time) {\n\t\t\t\t\tprev_time = p.time;\n\t\t\t\t\tfrag.appendChild(document.createElement('hr'));\n\t\t\t\t\tfrag.appendChild(_new_elem('div', 'new_time', KonOpas.pretty_time(p.t0 || p.time, konopas)))\n\t\t\t\t\t\t.setAttribute('data-day', p.date);\n\t\t\t\t}\n\t\t\t\tfrag.appendChild(KonOpas.Item.new(p));\n\t\t\t\t++opt.n_listed;\n\t\t\t}\n\t\t};\n\tif (!opt) opt = {};\n\topt.show_all = (ls.length <= konopas.max_items_per_page);\n\topt.n_hidden = 0; opt.n_listed = 0;\n\topt.now = new Date(_now + 10*60000 - _now % (10*60000));\n\tif (!opt.day || !konopas.program.days[opt.day]) {\n\t\tvar day_now = KonOpas.data_date(opt.now);\n\t\tif (konopas.program.days[day_now]) opt.day = day_now;\n\t\telse { opt.day = ''; for (opt.day in konopas.program.days) break; }\n\t}\n\tif (ls.length > (opt.id ? 1 : 0)) {\n\t\tfrag.appendChild(_new_elem('div', 'item_expander', ' '))\n\t\t\t.appendChild(_new_elem('a', 'js-link', i18n.txt('Expand all')))\n\t\t\t.id = 'item_expander_link';\n\t}\n\tls.forEach(_list_item, {hide_ended:opt.hide_ended});\n\tif (!opt.n_listed && opt.n_hidden) {\n\t\tday_lengths = {};\n\t\topt.n_hidden = 0; opt.n_listed = 0;\n\t\tprev_date = ''; prev_time = '';\n\t\tls.forEach(_list_item, {hide_ended:false});\n\t}\n\n\tfunction _day_link(t) {\n\t\tvar d = day_links[t],\n\t\t    txt = i18n.txt('day_link', {\n\t\t\t\t'N': day_lengths[d],\n\t\t\t\t'D': KonOpas.parse_date(d).getDay()\n\t\t\t}),\n\t\t    link = _new_elem('a', 'day-link js-link', txt);\n\t\tlink.id = t + '_day_link';\n\t\tlink.onclick = function() {\n\t\t\tif (t == 'next') window.scrollTo(0, 0);\n\t\t\topt.day = d;\n\t\t\tKonOpas.Item.show_list(ls, opt);\n\t\t};\n\t\treturn link;\n\t}\n\tfunction _hidden_link() {\n\t\tvar\ttxt = i18n.txt('hidden_link', {\n\t\t\t\t'N': opt.n_hidden,\n\t\t\t\t'T': KonOpas.pretty_time(opt.now, konopas),\n\t\t\t\t'D': opt.now.getDay()\n\t\t\t}),\n\t\t    link = _new_elem('a', 'day-link js-link', txt);\n\t\tlink.id = 'hidden_day_link';\n\t\tlink.onclick = function() {\n\t\t\topt.hide_ended = false;\n\t\t\topt.day = KonOpas.data_date(opt.now);\n\t\t\tKonOpas.Item.show_list(ls, opt);\n\t\t};\n\t\treturn link;\n\t}\n\tif (opt.day && !opt.show_all) for (var d in day_lengths) if (d in konopas.program.days) {\n\t\tif (d < opt.day) day_links['prev'] = d;\n\t\telse if ((d > opt.day) && !day_links['next']) day_links['next'] = d;\n\t}\n\tif (day_links['prev'] && !opt.n_hidden) frag.insertBefore(_day_link('prev'), frag.firstChild);\n\tif (day_links['next']) frag.appendChild(_day_link('next'));\n\tif (opt.n_hidden) frag.insertBefore(_hidden_link(), frag.firstChild);\n\n\tvar LS = _el('prog_ls');\n\twhile (LS.firstChild) LS.removeChild(LS.firstChild);\n\tLS.appendChild(frag);\n\n\tvar expand_all = _el(\"item_expander_link\");\n\tif (expand_all) expand_all.onclick = function() {\n\t\tvar items = LS.getElementsByClassName(\"item\");\n\t\tvar exp_txt = i18n.txt('Expand all');\n\t\tif (expand_all.textContent == exp_txt) {\n\t\t\tfor (var i = 0, l = items.length; i < l; ++i) {\n\t\t\t\titems[i].parentNode.classList.add(\"expanded\");\n\t\t\t\tKonOpas.Item.show_extra(items[i], items[i].id.substr(1));\n\t\t\t}\n\t\t\texpand_all.textContent = i18n.txt('Collapse all');\n\t\t} else {\n\t\t\tfor (var i = 0, l = items.length; i < l; ++i) {\n\t\t\t\titems[i].parentNode.classList.remove(\"expanded\");\n\t\t\t}\n\t\t\texpand_all.textContent = exp_txt;\n\t\t}\n\t};\n\n\tvar star_els = LS.getElementsByClassName(\"item_star\");\n\tfor (var i = 0, l = star_els.length; i < l; ++i) {\n\t\tstar_els[i].onclick = function() { konopas.stars.toggle(this, this.id.substr(1)); return false; };\n\t}\n\n\tkonopas.stars.list().forEach(function(s){\n\t\tvar el = _el('s' + s);\n\t\tif (el) el.classList.add('has_star');\n\t});\n\n\tif (opt.id) {\n\t\tvar it = document.getElementById('p' + opt.id);\n\t\tif (it) {\n\t\t\tit.parentNode.classList.add(\"expanded\");\n\t\t\tKonOpas.Item.show_extra(it, opt.id);\n\t\t\tif (ls.length > 1) it.scrollIntoView();\n\t\t}\n\t}\n\n\tif (opt.prog_view) {\n\t\tvar d_s = _el('day-sidebar'), d_n = _el('day-narrow'),\n\t\t    d_click = function(ev) {\n\t\t\t\tvar li = (ev || window.event).target,\n\t\t\t\t    d = li.getAttribute('data-day');\n\t\t\t\tif (!d) return;\n\t\t\t\topt.day = d;\n\t\t\t\tif (opt.show_all) {\n\t\t\t\t\tvar dt = _el('dt_' + d);\n\t\t\t\t\tif (dt) {\n\t\t\t\t\t\tdt.scrollIntoView();\n\t\t\t\t\t\tKonOpas.Prog.focus_day(d);\n\t\t\t\t\t} else if (d < KonOpas.data_date(opt.now)) {\n\t\t\t\t\t\topt.hide_ended = false;\n\t\t\t\t\t\tKonOpas.Item.show_list(ls, opt);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\topt.hide_ended = true;\n\t\t\t\t\tKonOpas.Item.show_list(ls, opt);\n\t\t\t\t}\n\t\t\t},\n\t\t    d_set = function(div, len) {\n\t\t\t\tvar ul = document.createElement('ul');\n\t\t\t\tul.className = 'day-list';\n\t\t\t\tul.onclick = d_click;\n\t\t\t\tfor (var d in konopas.program.days) {\n\t\t\t\t\tvar li = document.createElement('li');\n\t\t\t\t\tli.textContent = konopas.program.days[d][len] + ' (' + (day_lengths[d] || 0) + ')';\n\t\t\t\t\tli.setAttribute('data-day', d);\n\t\t\t\t\tif (d == opt.day) li.className = 'selected';\n\t\t\t\t\tul.appendChild(li);\n\t\t\t\t}\n\t\t\t\tdiv.innerHTML = '';\n\t\t\t\tdiv.appendChild(ul);\n\t\t\t};\n\t\tif (d_s) d_set(d_s, 'long');\n\t\tif (d_n) d_set(d_n, 'short');\n\t\tkonopas.program.show_filter_sum(ls, opt);\n\t}\n\n\tkonopas.item.scroll.i = 0;\n\twindow.onscroll && window.onscroll();\n}\n\nKonOpas.Item.list_click = function(ev) {\n\tvar el = (ev || window.event).target,\n\t    is_link = false;\n\twhile (el && !/\\bitem(_|$)/.test(el.className)) {\n\t\tif (el.id == 'prog_ls') return;\n\t\tif ((el.tagName.toLowerCase() == 'a') && el.href) is_link = true;\n\t\tel = el.parentNode;\n\t\tif (!el) return;\n\t}\n\tif (el && el.id && (el.id[0] == 'p') && !is_link) {\n\t\tif (el.parentNode.classList.toggle(\"expanded\")) {\n\t\t\tKonOpas.Item.show_extra(el, el.id.substr(1));\n\t\t}\n\t}\n}\n\nKonOpas.Item.prototype.scroll_time = function() {\n\tvar S = this.scroll,\n\t\tst_len = S.times.length,\n\t    scroll_top = window.pageYOffset + 20; // to have more time for change behind new_time\n\tif (!S.t_el || !st_len) return;\n\tif (scroll_top < S.times[0].offsetTop) {\n\t\tS.i = 0;\n\t\tS.top = S.times[0].offsetTop;\n\t\tS.t_el.style.display = 'none';\n\t\tvar day0 = S.times[0].getAttribute('data-day');\n\t\tif (day0 != S.day) {\n\t\t\tKonOpas.Prog.focus_day(day0);\n\t\t\tS.day = day0;\n\t\t}\n\t} else {\n\t\tvar i = S.top ? S.i : 1;\n\t\tif (i >= st_len) i = st_len - 1;\n\t\tif (scroll_top > S.times[i].offsetTop) {\n\t\t\twhile ((i < st_len) && (scroll_top > S.times[i].offsetTop)) ++i;\n\t\t\t--i;\n\t\t} else {\n\t\t\twhile ((i >= 0) && (scroll_top < S.times[i].offsetTop)) --i;\n\t\t}\n\t\tif (i < 0) i = 0;\n\t\tif ((i == 0) || (i != S.i)) {\n\t\t\tS.i = i;\n\t\t\tS.top = S.times[i].offsetTop;\n\t\t\tvar day0 = S.times[i].getAttribute('data-day'),\n\t\t\t    day1 = ((i + 1 < st_len) && S.times[i+1].getAttribute('data-day')) || day0;\n\t\t\tS.t_el.textContent = konopas.program.days[day0]['short'] + '\\n' + S.times[i].textContent;\n\t\t\tS.t_el.style.display = 'block';\n\t\t\tif (day1 != S.day) {\n\t\t\t\tKonOpas.Prog.focus_day(day1);\n\t\t\t\tS.day = day1;\n\t\t\t}\n\t\t}\n\t}\n\tif (S.s_el) S.s_el.style.display = S.t_el.style.display;\n}\nKonOpas.Part = function(list, opt) {\n\tthis.list = list || [];\n\tthis.list.forEach(function(p){\n\t\tp.sortname = ((p.name[1] || '') + '  ' + p.name[0]).toLowerCase().replace(/^[\\s/()]+/, '');\n\t\tif (!opt.non_ascii_people) p.sortname = p.sortname.make_ascii();\n\t});\n\tthis.list.sort(opt.non_ascii_people\n\t\t? function(a, b) { return a.sortname.localeCompare(b.sortname, opt.lc); }\n\t\t: function(a, b) { return a.sortname < b.sortname ? -1 : a.sortname > b.sortname; });\n\tthis.set_ranges(opt.people_per_screen || 0);\n}\n\nKonOpas.Part.prototype.set_ranges = function(bin_size) {\n\tvar\tself = this,\n\t\t_ranges = function(a, bin_size) {\n\t\t\tvar\tends = [], start = ' ',\n\t\t\t\tn_bins = bin_size ? Math.round(a.length / bin_size) : 0,\n\t\t\t\t_prev_matches = function(a, i) { return (i > 0) && (a[i - 1] == a[i]); },\n\t\t\t\t_next_matches = function(a, i) { return (i < a.length - 1) && (a[i + 1] == a[i]); };\n\t\t\tfor (var i = 1; i <= n_bins; ++i) {\n\t\t\t\tvar e = Math.round(i * a.length / n_bins), n_up = 0, n_down = 0;\n\t\t\t\tif (e < 0) e = 0;\n\t\t\t\tif (e >= a.length) e = a.length - 1;\n\t\t\t\twhile (_next_matches(a, e + n_up)) ++n_up;\n\t\t\t\tif (n_up) while (_prev_matches(a, e - n_down)) ++n_down;\n\t\t\t\tif (n_up <= n_down) e += n_up;\n\t\t\t\telse if (e > n_down) e -= n_down + 1;\n\t\t\t\tif (!ends.length || (ends[ends.length - 1] != a[e])) ends.push(a[e]);\n\t\t\t}\n\t\t\tends.forEach(function(e, i){\n\t\t\t\tif (e > start) ends[i] = start + e;\n\t\t\t\tif (e >= start) start = String.fromCharCode(e.charCodeAt(0) + 1);\n\t\t\t});\n\t\t\treturn ends;\n\t\t},\n\t\t_range_set = function(div, nr) {\n\t\t\tvar ul = _new_elem('ul', 'name-list');\n\t\t\tnr.forEach(function(n){\n\t\t\t\tvar startChar = n.charAt(0);\n\t\t\t\tif (startChar == ' ') startChar = 'A';\n\t\t\t\tvar li = _new_elem('li', '', startChar);\n\t\t\t\tif (n.length > 1) li.textContent += ' - ' + n.charAt(1);\n\t\t\t\tli.setAttribute('data-range', n);\n\t\t\t\tul.appendChild(li);\n\t\t\t});\n\t\t\tdiv.appendChild(ul);\n\t\t\tdiv.onclick = (function(ev) {\n\t\t\t\tvar name_range = (ev || window.event).target.getAttribute('data-range');\n\t\t\t\tif (name_range) {\n\t\t\t\t\tkonopas.store.set('part', { 'name_range': name_range, 'participant': '' });\n\t\t\t\t\twindow.location.hash = '#part';\n\t\t\t\t\tthis.update_view(name_range, '');\n\t\t\t\t}\n\t\t\t}).bind(self);\n\t\t},\n\t\t_firstletter = function(name) {\n\t\t\treturn name.replace(/^[\\s/(]+/, '').charAt(0).toUpperCase()\n\t\t}\n\n\tvar fn = [], ln = [];\n\n\tthis.list.forEach(function(p){\n\t\tif (p.name && p.name.length) {\n\t\t\tfn.push(_firstletter(p.name[0]));\n\t\t\tif (p.name.length >= 2) ln.push(_firstletter(p.name[1]) || _firstletter(p.name[0]));\n\t\t}\n\t});\n\n\tthis.ranges = _ranges(ln.length ? ln : fn, bin_size);\n\t_range_set(_el('part-sidebar'), this.ranges);\n\t_range_set(_el('part-narrow'), this.ranges);\n\n\tvar nl_type =  fn.length &&  ln.length ? ''\n\t            :  fn.length && !ln.length ? 'fn-only'\n\t            : !fn.length &&  ln.length ? 'ln-only'\n\t            : 'error';\n\tif (nl_type) _el('part_names').classList.add(nl_type);\n}\n\nKonOpas.Part.name_in_range = function(n0, range) {\n\tswitch (range.length) {\n\t\tcase 1:  return (n0 == range[0]);\n\t\tcase 2:  return konopas.non_ascii_people\n\t\t\t? (n0.localeCompare(range[0], konopas.lc) >= 0) && (n0.localeCompare(range[1], konopas.lc) <= 0)\n\t\t\t: ((n0 >= range[0]) && (n0 <= range[1]));\n\t\tdefault: return (range.indexOf(n0) >= 0);\n\t}\n}\n\nKonOpas.Part.prototype.show_one = function(i) {\n\tvar p = this.list[i],\n\t    p_name = KonOpas.clean_name(p, false),\n\t    links = '',\n\t    img = '',\n\t    pl = KonOpas.clean_links(p);\n\tif (pl) {\n\t\tlinks += '<dl class=\"linklist\">';\n\t\tfor (var type in pl) if (type != 'img') {\n\t\t\tvar tgt = pl[type].tgt, txt = pl[type].txt || tgt;\n\t\t\tlinks += '<dt>' + type + ':<dd>' + '<a href=\"' + tgt + '\">' + txt + '</a>';\n\t\t}\n\t\tlinks += '</dl>';\n\t\tif (pl.img && navigator.onLine) {\n\t\t\timg = '<a class=\"part_img\" href=\"' + pl.img.tgt + '\"><img src=\"' + pl.img.tgt + '\" alt=\"' + i18n.txt('Photo') + ': ' + p_name + '\"></a>';\n\t\t}\n\t}\n\t_el(\"part_names\").innerHTML = '';\n\t_el(\"part_info\").innerHTML =\n\t\t  '<h2 id=\"part_title\">' + p_name + '</h2>'\n\t\t+ ((p.bio || img) ? ('<p>' + img + p.bio) : '')\n\t\t+ links;\n\tKonOpas.Item.show_list(konopas.program.list.filter(function(it) { return p.prog.indexOf(it.id) >= 0; }));\n\t_el(\"top\").scrollIntoView();\n}\n\nKonOpas.Part.prototype.show_list = function(name_range) {\n\tvar lp = !name_range ? this.list : this.list.filter(function(p) {\n\t\tvar n0 = p.sortname[0].toUpperCase();\n\t\treturn KonOpas.Part.name_in_range(n0, name_range);\n\t});\n\t_el('part_names').innerHTML = lp.map(function(p) {\n\t\treturn '<li><a href=\"#part/' + KonOpas.hash_encode(p.id) + '\">' + KonOpas.clean_name(p, true) + '</a></li>';\n\t}).join('');\n\t_el('part_info').innerHTML = '';\n\t_el('prog_ls').innerHTML = '';\n}\n\nKonOpas.Part.prototype.update_view = function(name_range, participant) {\n\tvar\tp_id = participant.substr(1),\n\t\tll = document.querySelectorAll('.name-list > li');\n\tif (!name_range) name_range = this.ranges && this.ranges[0] || '';\n\tfor (var i = 0; i < ll.length; ++i) {\n\t\tvar cmd = (ll[i].getAttribute('data-range') == name_range) ? 'add' : 'remove';\n\t\tll[i].classList[cmd]('selected');\n\t}\n\tif (!p_id || !this.list.some(function(p,i){\n\t\tif (p.id == p_id) { this.show_one(i); return true; }\n\t}, this)) {\n\t\tparticipant = '';\n\t\tthis.show_list(name_range);\n\t}\n\tkonopas.store.set('part', { 'name_range': name_range, 'participant': participant });\n}\n\nKonOpas.Part.prototype.show = function(hash) {\n\tif (!this.list.length) { window.location.hash = ''; return; }\n\tvar store = konopas.store.get('part') || {},\n\t    name_range = store.name_range || '',\n\t    participant = !document.body.classList.contains('part') && store.participant || '',\n\t\thash = window.location.hash.substr(6);\n\tif (hash) {\n\t\tvar p_id = KonOpas.hash_decode(hash);\n\t\tvar pa = this.list.filter(function(p) { return p.id == p_id; });\n\t\tif (pa.length) {\n\t\t\tparticipant = 'p' + pa[0].id;\n\t\t\tvar n0 = pa[0].sortname[0].toUpperCase();\n\t\t\tif (!n0 || !this.ranges || !this.ranges.some(function(r){\n\t\t\t\tif (KonOpas.Part.name_in_range(n0, r)) { name_range = r; return true; }\n\t\t\t})) name_range = '';\n\t\t} else {\n\t\t\twindow.location.hash = '#part';\n\t\t\treturn;\n\t\t}\n\t} else if (participant) {\n\t\twindow.location.hash = '#part/' + participant.substr(1);\n\t\treturn;\n\t}\n\tthis.update_view(name_range, participant);\n}\nif (!String.prototype.trim) {\n\tString.prototype.trim = function () {\n\t\treturn this.replace(/^\\s+|\\s+$/g, '');\n\t};\n}\n\n\nif (!Function.prototype.bind) {\n  Function.prototype.bind = function (oThis) {\n    if (typeof this !== \"function\") {\n      // closest thing possible to the ECMAScript 5\n      // internal IsCallable function\n      throw new TypeError(\"Function.prototype.bind - what is trying to be bound is not callable\");\n    }\n    var aArgs = Array.prototype.slice.call(arguments, 1),\n        fToBind = this,\n        fNOP = function () {},\n        fBound = function () {\n          return fToBind.apply(this instanceof fNOP && oThis\n                 ? this\n                 : oThis,\n                 aArgs.concat(Array.prototype.slice.call(arguments)));\n        };\n    fNOP.prototype = this.prototype;\n    fBound.prototype = new fNOP();\n    return fBound;\n  };\n}\n\n\nif ((function(){\n\ttry { new Date().toLocaleDateString(\"i\"); }\n\tcatch (e) { return e.name !== \"RangeError\"; }\n\treturn true;\n})()) {\n\tDate.prototype._orig_toLocaleDateString = Date.prototype.toLocaleDateString;\n\tDate.prototype.toLocaleDateString = function(locale, options) {\n\t\tif (!arguments.length || (typeof i18n == 'undefined')) return this._orig_toLocaleDateString();\n\t\tvar i = function(key, data){ return key in i18n[locale] ? i18n[locale][key](data) : key; },\n\t\t    w = i('weekday_n', { 'N': this.getDay() }),\n\t\t    d = this.getDate(),\n\t\t    m = i('month_n', { 'N': this.getMonth() }),\n\t\t    s = w + ', ' + d + ' ' + m;\n\t\tif (options && options.year) s += ' ' + this.getFullYear();\n\t\treturn s;\n\t};\n}\n\n\nString.prototype.make_ascii = String.prototype.normalize\n\t? function() {\n\t\treturn this.normalize('NFKD').replace(/[^\\x00-\\x7F]/g, '');\n\t}\n\t: function() {\n\t\tvar str = this.toString();\n\t\tif (/^[\\x00-\\x7F]*$/.test(str)) return str;\n\t\t// map from http://web.archive.org/web/20120918093154/http://lehelk.com/2011/05/06/script-to-remove-diacritics/\n\t\tvar norm_map = {\n\t\t\t'A': /[\\u0041\\u24B6\\uFF21\\u00C0\\u00C1\\u00C2\\u1EA6\\u1EA4\\u1EAA\\u1EA8\\u00C3\\u0100\\u0102\\u1EB0\\u1EAE\\u1EB4\\u1EB2\\u0226\\u01E0\\u00C4\\u01DE\\u1EA2\\u00C5\\u01FA\\u01CD\\u0200\\u0202\\u1EA0\\u1EAC\\u1EB6\\u1E00\\u0104\\u023A\\u2C6F]/g,\n\t\t\t'AA':/[\\uA732]/g,\n\t\t\t'AE':/[\\u00C6\\u01FC\\u01E2]/g,\n\t\t\t'AO':/[\\uA734]/g,\n\t\t\t'AU':/[\\uA736]/g,\n\t\t\t'AV':/[\\uA738\\uA73A]/g,\n\t\t\t'AY':/[\\uA73C]/g,\n\t\t\t'B': /[\\u0042\\u24B7\\uFF22\\u1E02\\u1E04\\u1E06\\u0243\\u0182\\u0181]/g,\n\t\t\t'C': /[\\u0043\\u24B8\\uFF23\\u0106\\u0108\\u010A\\u010C\\u00C7\\u1E08\\u0187\\u023B\\uA73E]/g,\n\t\t\t'D': /[\\u0044\\u24B9\\uFF24\\u1E0A\\u010E\\u1E0C\\u1E10\\u1E12\\u1E0E\\u0110\\u018B\\u018A\\u0189\\uA779]/g,\n\t\t\t'DZ':/[\\u01F1\\u01C4]/g,\n\t\t\t'Dz':/[\\u01F2\\u01C5]/g,\n\t\t\t'E': /[\\u0045\\u24BA\\uFF25\\u00C8\\u00C9\\u00CA\\u1EC0\\u1EBE\\u1EC4\\u1EC2\\u1EBC\\u0112\\u1E14\\u1E16\\u0114\\u0116\\u00CB\\u1EBA\\u011A\\u0204\\u0206\\u1EB8\\u1EC6\\u0228\\u1E1C\\u0118\\u1E18\\u1E1A\\u0190\\u018E]/g,\n\t\t\t'F': /[\\u0046\\u24BB\\uFF26\\u1E1E\\u0191\\uA77B]/g,\n\t\t\t'G': /[\\u0047\\u24BC\\uFF27\\u01F4\\u011C\\u1E20\\u011E\\u0120\\u01E6\\u0122\\u01E4\\u0193\\uA7A0\\uA77D\\uA77E]/g,\n\t\t\t'H': /[\\u0048\\u24BD\\uFF28\\u0124\\u1E22\\u1E26\\u021E\\u1E24\\u1E28\\u1E2A\\u0126\\u2C67\\u2C75\\uA78D]/g,\n\t\t\t'I': /[\\u0049\\u24BE\\uFF29\\u00CC\\u00CD\\u00CE\\u0128\\u012A\\u012C\\u0130\\u00CF\\u1E2E\\u1EC8\\u01CF\\u0208\\u020A\\u1ECA\\u012E\\u1E2C\\u0197]/g,\n\t\t\t'J': /[\\u004A\\u24BF\\uFF2A\\u0134\\u0248]/g,\n\t\t\t'K': /[\\u004B\\u24C0\\uFF2B\\u1E30\\u01E8\\u1E32\\u0136\\u1E34\\u0198\\u2C69\\uA740\\uA742\\uA744\\uA7A2]/g,\n\t\t\t'L': /[\\u004C\\u24C1\\uFF2C\\u013F\\u0139\\u013D\\u1E36\\u1E38\\u013B\\u1E3C\\u1E3A\\u0141\\u023D\\u2C62\\u2C60\\uA748\\uA746\\uA780]/g,\n\t\t\t'LJ':/[\\u01C7]/g,\n\t\t\t'Lj':/[\\u01C8]/g,\n\t\t\t'M': /[\\u004D\\u24C2\\uFF2D\\u1E3E\\u1E40\\u1E42\\u2C6E\\u019C]/g,\n\t\t\t'N': /[\\u004E\\u24C3\\uFF2E\\u01F8\\u0143\\u00D1\\u1E44\\u0147\\u1E46\\u0145\\u1E4A\\u1E48\\u0220\\u019D\\uA790\\uA7A4]/g,\n\t\t\t'NJ':/[\\u01CA]/g,\n\t\t\t'Nj':/[\\u01CB]/g,\n\t\t\t'O': /[\\u004F\\u24C4\\uFF2F\\u00D2\\u00D3\\u00D4\\u1ED2\\u1ED0\\u1ED6\\u1ED4\\u00D5\\u1E4C\\u022C\\u1E4E\\u014C\\u1E50\\u1E52\\u014E\\u022E\\u0230\\u00D6\\u022A\\u1ECE\\u0150\\u01D1\\u020C\\u020E\\u01A0\\u1EDC\\u1EDA\\u1EE0\\u1EDE\\u1EE2\\u1ECC\\u1ED8\\u01EA\\u01EC\\u00D8\\u01FE\\u0186\\u019F\\uA74A\\uA74C]/g,\n\t\t\t'OI':/[\\u01A2]/g,\n\t\t\t'OO':/[\\uA74E]/g,\n\t\t\t'OU':/[\\u0222]/g,\n\t\t\t'P': /[\\u0050\\u24C5\\uFF30\\u1E54\\u1E56\\u01A4\\u2C63\\uA750\\uA752\\uA754]/g,\n\t\t\t'Q': /[\\u0051\\u24C6\\uFF31\\uA756\\uA758\\u024A]/g,\n\t\t\t'R': /[\\u0052\\u24C7\\uFF32\\u0154\\u1E58\\u0158\\u0210\\u0212\\u1E5A\\u1E5C\\u0156\\u1E5E\\u024C\\u2C64\\uA75A\\uA7A6\\uA782]/g,\n\t\t\t'S': /[\\u0053\\u24C8\\uFF33\\u1E9E\\u015A\\u1E64\\u015C\\u1E60\\u0160\\u1E66\\u1E62\\u1E68\\u0218\\u015E\\u2C7E\\uA7A8\\uA784]/g,\n\t\t\t'T': /[\\u0054\\u24C9\\uFF34\\u1E6A\\u0164\\u1E6C\\u021A\\u0162\\u1E70\\u1E6E\\u0166\\u01AC\\u01AE\\u023E\\uA786]/g,\n\t\t\t'TZ':/[\\uA728]/g,\n\t\t\t'U': /[\\u0055\\u24CA\\uFF35\\u00D9\\u00DA\\u00DB\\u0168\\u1E78\\u016A\\u1E7A\\u016C\\u00DC\\u01DB\\u01D7\\u01D5\\u01D9\\u1EE6\\u016E\\u0170\\u01D3\\u0214\\u0216\\u01AF\\u1EEA\\u1EE8\\u1EEE\\u1EEC\\u1EF0\\u1EE4\\u1E72\\u0172\\u1E76\\u1E74\\u0244]/g,\n\t\t\t'V': /[\\u0056\\u24CB\\uFF36\\u1E7C\\u1E7E\\u01B2\\uA75E\\u0245]/g,\n\t\t\t'VY':/[\\uA760]/g,\n\t\t\t'W': /[\\u0057\\u24CC\\uFF37\\u1E80\\u1E82\\u0174\\u1E86\\u1E84\\u1E88\\u2C72]/g,\n\t\t\t'X': /[\\u0058\\u24CD\\uFF38\\u1E8A\\u1E8C]/g,\n\t\t\t'Y': /[\\u0059\\u24CE\\uFF39\\u1EF2\\u00DD\\u0176\\u1EF8\\u0232\\u1E8E\\u0178\\u1EF6\\u1EF4\\u01B3\\u024E\\u1EFE]/g,\n\t\t\t'Z': /[\\u005A\\u24CF\\uFF3A\\u0179\\u1E90\\u017B\\u017D\\u1E92\\u1E94\\u01B5\\u0224\\u2C7F\\u2C6B\\uA762]/g,\n\t\t\t'a': /[\\u0061\\u24D0\\uFF41\\u1E9A\\u00E0\\u00E1\\u00E2\\u1EA7\\u1EA5\\u1EAB\\u1EA9\\u00E3\\u0101\\u0103\\u1EB1\\u1EAF\\u1EB5\\u1EB3\\u0227\\u01E1\\u00E4\\u01DF\\u1EA3\\u00E5\\u01FB\\u01CE\\u0201\\u0203\\u1EA1\\u1EAD\\u1EB7\\u1E01\\u0105\\u2C65\\u0250]/g,\n\t\t\t'aa':/[\\uA733]/g,\n\t\t\t'ae':/[\\u00E6\\u01FD\\u01E3]/g,\n\t\t\t'ao':/[\\uA735]/g,\n\t\t\t'au':/[\\uA737]/g,\n\t\t\t'av':/[\\uA739\\uA73B]/g,\n\t\t\t'ay':/[\\uA73D]/g,\n\t\t\t'b': /[\\u0062\\u24D1\\uFF42\\u1E03\\u1E05\\u1E07\\u0180\\u0183\\u0253]/g,\n\t\t\t'c': /[\\u0063\\u24D2\\uFF43\\u0107\\u0109\\u010B\\u010D\\u00E7\\u1E09\\u0188\\u023C\\uA73F\\u2184]/g,\n\t\t\t'd': /[\\u0064\\u24D3\\uFF44\\u1E0B\\u010F\\u1E0D\\u1E11\\u1E13\\u1E0F\\u0111\\u018C\\u0256\\u0257\\uA77A]/g,\n\t\t\t'dz':/[\\u01F3\\u01C6]/g,\n\t\t\t'e': /[\\u0065\\u24D4\\uFF45\\u00E8\\u00E9\\u00EA\\u1EC1\\u1EBF\\u1EC5\\u1EC3\\u1EBD\\u0113\\u1E15\\u1E17\\u0115\\u0117\\u00EB\\u1EBB\\u011B\\u0205\\u0207\\u1EB9\\u1EC7\\u0229\\u1E1D\\u0119\\u1E19\\u1E1B\\u0247\\u025B\\u01DD]/g,\n\t\t\t'f': /[\\u0066\\u24D5\\uFF46\\u1E1F\\u0192\\uA77C]/g,\n\t\t\t'g': /[\\u0067\\u24D6\\uFF47\\u01F5\\u011D\\u1E21\\u011F\\u0121\\u01E7\\u0123\\u01E5\\u0260\\uA7A1\\u1D79\\uA77F]/g,\n\t\t\t'h': /[\\u0068\\u24D7\\uFF48\\u0125\\u1E23\\u1E27\\u021F\\u1E25\\u1E29\\u1E2B\\u1E96\\u0127\\u2C68\\u2C76\\u0265]/g,\n\t\t\t'hv':/[\\u0195]/g,\n\t\t\t'i': /[\\u0069\\u24D8\\uFF49\\u00EC\\u00ED\\u00EE\\u0129\\u012B\\u012D\\u00EF\\u1E2F\\u1EC9\\u01D0\\u0209\\u020B\\u1ECB\\u012F\\u1E2D\\u0268\\u0131]/g,\n\t\t\t'j': /[\\u006A\\u24D9\\uFF4A\\u0135\\u01F0\\u0249]/g,\n\t\t\t'k': /[\\u006B\\u24DA\\uFF4B\\u1E31\\u01E9\\u1E33\\u0137\\u1E35\\u0199\\u2C6A\\uA741\\uA743\\uA745\\uA7A3]/g,\n\t\t\t'l': /[\\u006C\\u24DB\\uFF4C\\u0140\\u013A\\u013E\\u1E37\\u1E39\\u013C\\u1E3D\\u1E3B\\u017F\\u0142\\u019A\\u026B\\u2C61\\uA749\\uA781\\uA747]/g,\n\t\t\t'lj':/[\\u01C9]/g,\n\t\t\t'm': /[\\u006D\\u24DC\\uFF4D\\u1E3F\\u1E41\\u1E43\\u0271\\u026F]/g,\n\t\t\t'n': /[\\u006E\\u24DD\\uFF4E\\u01F9\\u0144\\u00F1\\u1E45\\u0148\\u1E47\\u0146\\u1E4B\\u1E49\\u019E\\u0272\\u0149\\uA791\\uA7A5]/g,\n\t\t\t'nj':/[\\u01CC]/g,\n\t\t\t'o': /[\\u006F\\u24DE\\uFF4F\\u00F2\\u00F3\\u00F4\\u1ED3\\u1ED1\\u1ED7\\u1ED5\\u00F5\\u1E4D\\u022D\\u1E4F\\u014D\\u1E51\\u1E53\\u014F\\u022F\\u0231\\u00F6\\u022B\\u1ECF\\u0151\\u01D2\\u020D\\u020F\\u01A1\\u1EDD\\u1EDB\\u1EE1\\u1EDF\\u1EE3\\u1ECD\\u1ED9\\u01EB\\u01ED\\u00F8\\u01FF\\u0254\\uA74B\\uA74D\\u0275]/g,\n\t\t\t'oi':/[\\u01A3]/g,\n\t\t\t'ou':/[\\u0223]/g,\n\t\t\t'oo':/[\\uA74F]/g,\n\t\t\t'p': /[\\u0070\\u24DF\\uFF50\\u1E55\\u1E57\\u01A5\\u1D7D\\uA751\\uA753\\uA755]/g,\n\t\t\t'q': /[\\u0071\\u24E0\\uFF51\\u024B\\uA757\\uA759]/g,\n\t\t\t'r': /[\\u0072\\u24E1\\uFF52\\u0155\\u1E59\\u0159\\u0211\\u0213\\u1E5B\\u1E5D\\u0157\\u1E5F\\u024D\\u027D\\uA75B\\uA7A7\\uA783]/g,\n\t\t\t's': /[\\u0073\\u24E2\\uFF53\\u00DF\\u015B\\u1E65\\u015D\\u1E61\\u0161\\u1E67\\u1E63\\u1E69\\u0219\\u015F\\u023F\\uA7A9\\uA785\\u1E9B]/g,\n\t\t\t't': /[\\u0074\\u24E3\\uFF54\\u1E6B\\u1E97\\u0165\\u1E6D\\u021B\\u0163\\u1E71\\u1E6F\\u0167\\u01AD\\u0288\\u2C66\\uA787]/g,\n\t\t\t'tz':/[\\uA729]/g,\n\t\t\t'u': /[\\u0075\\u24E4\\uFF55\\u00F9\\u00FA\\u00FB\\u0169\\u1E79\\u016B\\u1E7B\\u016D\\u00FC\\u01DC\\u01D8\\u01D6\\u01DA\\u1EE7\\u016F\\u0171\\u01D4\\u0215\\u0217\\u01B0\\u1EEB\\u1EE9\\u1EEF\\u1EED\\u1EF1\\u1EE5\\u1E73\\u0173\\u1E77\\u1E75\\u0289]/g,\n\t\t\t'v': /[\\u0076\\u24E5\\uFF56\\u1E7D\\u1E7F\\u028B\\uA75F\\u028C]/g,\n\t\t\t'vy':/[\\uA761]/g,\n\t\t\t'w': /[\\u0077\\u24E6\\uFF57\\u1E81\\u1E83\\u0175\\u1E87\\u1E85\\u1E98\\u1E89\\u2C73]/g,\n\t\t\t'x': /[\\u0078\\u24E7\\uFF58\\u1E8B\\u1E8D]/g,\n\t\t\t'y': /[\\u0079\\u24E8\\uFF59\\u1EF3\\u00FD\\u0177\\u1EF9\\u0233\\u1E8F\\u00FF\\u1EF7\\u1E99\\u1EF5\\u01B4\\u024F\\u1EFF]/g,\n\t\t\t'z': /[\\u007A\\u24E9\\uFF5A\\u017A\\u1E91\\u017C\\u017E\\u1E93\\u1E95\\u01B6\\u0225\\u0240\\u2C6C\\uA763]/g\n\t\t};\n\t\tfor (var l in norm_map) {\n\t\t\tstr = str.replace(norm_map[l], l);\n\t\t}\n\t\treturn str.replace(/[^\\x00-\\x7F]/g, '');\n\t};\n\n\n/*\n * classList.js: Cross-browser full element.classList implementation.\n * 2011-06-15\n *\n * By Eli Grey, http://eligrey.com\n * Public Domain.\n * NO WARRANTY EXPRESSED OR IMPLIED. USE AT YOUR OWN RISK.\n */\n\n/*global self, document, DOMException */\n\n/*! @source http://purl.eligrey.com/github/classList.js/blob/master/classList.js*/\n\nif (typeof document !== \"undefined\" && !(\"classList\" in document.createElement(\"a\"))) {\n\n(function (view) {\n\nvar\n\t  classListProp = \"classList\"\n\t, protoProp = \"prototype\"\n\t, elemCtrProto = (view.HTMLElement || view.Element)[protoProp]\n\t, objCtr = Object\n\t, strTrim = String[protoProp].trim || function () {\n\t\treturn this.replace(/^\\s+|\\s+$/g, \"\");\n\t}\n\t, arrIndexOf = Array[protoProp].indexOf || function (item) {\n\t\tvar\n\t\t\t  i = 0\n\t\t\t, len = this.length\n\t\t;\n\t\tfor (; i < len; i++) {\n\t\t\tif (i in this && this[i] === item) {\n\t\t\t\treturn i;\n\t\t\t}\n\t\t}\n\t\treturn -1;\n\t}\n\t// Vendors: please allow content code to instantiate DOMExceptions\n\t, DOMEx = function (type, message) {\n\t\tthis.name = type;\n\t\tthis.code = DOMException[type];\n\t\tthis.message = message;\n\t}\n\t, checkTokenAndGetIndex = function (classList, token) {\n\t\tif (token === \"\") {\n\t\t\tthrow new DOMEx(\n\t\t\t\t  \"SYNTAX_ERR\"\n\t\t\t\t, \"An invalid or illegal string was specified\"\n\t\t\t);\n\t\t}\n\t\tif (/\\s/.test(token)) {\n\t\t\tthrow new DOMEx(\n\t\t\t\t  \"INVALID_CHARACTER_ERR\"\n\t\t\t\t, \"String contains an invalid character\"\n\t\t\t);\n\t\t}\n\t\treturn arrIndexOf.call(classList, token);\n\t}\n\t, ClassList = function (elem) {\n\t\tvar\n\t\t\t  trimmedClasses = strTrim.call(elem.className)\n\t\t\t, classes = trimmedClasses ? trimmedClasses.split(/\\s+/) : []\n\t\t\t, i = 0\n\t\t\t, len = classes.length\n\t\t;\n\t\tfor (; i < len; i++) {\n\t\t\tthis.push(classes[i]);\n\t\t}\n\t\tthis._updateClassName = function () {\n\t\t\telem.className = this.toString();\n\t\t};\n\t}\n\t, classListProto = ClassList[protoProp] = []\n\t, classListGetter = function () {\n\t\treturn new ClassList(this);\n\t}\n;\n// Most DOMException implementations don't allow calling DOMException's toString()\n// on non-DOMExceptions. Error's toString() is sufficient here.\nDOMEx[protoProp] = Error[protoProp];\nclassListProto.item = function (i) {\n\treturn this[i] || null;\n};\nclassListProto.contains = function (token) {\n\ttoken += \"\";\n\treturn checkTokenAndGetIndex(this, token) !== -1;\n};\nclassListProto.add = function (token) {\n\ttoken += \"\";\n\tif (checkTokenAndGetIndex(this, token) === -1) {\n\t\tthis.push(token);\n\t\tthis._updateClassName();\n\t}\n};\nclassListProto.remove = function (token) {\n\ttoken += \"\";\n\tvar index = checkTokenAndGetIndex(this, token);\n\tif (index !== -1) {\n\t\tthis.splice(index, 1);\n\t\tthis._updateClassName();\n\t}\n};\nclassListProto.toggle = function (token) {\n\ttoken += \"\";\n\tif (checkTokenAndGetIndex(this, token) === -1) {\n\t\tthis.add(token);\n\t} else {\n\t\tthis.remove(token);\n\t}\n};\nclassListProto.toString = function () {\n\treturn this.join(\" \");\n};\n \nif (objCtr.defineProperty) {\n\tvar classListPropDesc = {\n\t\t  get: classListGetter\n\t\t, enumerable: true\n\t\t, configurable: true\n\t};\n\ttry {\n\t\tobjCtr.defineProperty(elemCtrProto, classListProp, classListPropDesc);\n\t} catch (ex) { // IE 8 doesn't support enumerable:true\n\t\tif (ex.number === -0x7FF5EC54) {\n\t\t\tclassListPropDesc.enumerable = false;\n\t\t\tobjCtr.defineProperty(elemCtrProto, classListProp, classListPropDesc);\n\t\t}\n\t}\n} else if (objCtr[protoProp].__defineGetter__) {\n\telemCtrProto.__defineGetter__(classListProp, classListGetter);\n}\n \n}(self));\n \n}\nKonOpas.Prog = function(list, opt) {\n\tfunction _sort(a, b) {\n\t\tif (!a.date != !b.date) return a.date ? -1 : 1;\n\t\tif (a.date < b.date) return -1;\n\t\tif (a.date > b.date) return  1;\n\t\tif (!a.time != !b.time) return a.time ? 1 : -1;\n\t\tif (a.time < b.time) return -1;\n\t\tif (a.time > b.time) return  1;\n\t\tif (a.loc && b.loc) {\n\t\t\tif (a.loc.length < b.loc.length) return -1;\n\t\t\tif (a.loc.length > b.loc.length) return  1;\n\t\t\tfor (var i = a.loc.length - 1; i >= 0; --i) {\n\t\t\t\tif (a.loc[i] < b.loc[i]) return -1;\n\t\t\t\tif (a.loc[i] > b.loc[i]) return  1;\n\t\t\t}\n\t\t}\n\t\treturn 0;\n\t}\n\tthis.list = (list || []).sort(_sort);\n\tthis.list.forEach(function(p) {\n\t\tif (p && p.date) {\n\t\t\tvar d = p.date.split(/\\D+/),\n\t\t\t    t = p.time && p.time.split(/\\D+/) || [0,0],\n\t\t\t\tm = p.time && Number(p.mins || KonOpas.default_duration) || (!p.time && 24*60-1) || 0;\n\t\t\tp.t0 = new Date(d[0], d[1] - 1, d[2], t[0], t[1]);\n\t\t\tif (isNaN(p.t0)) delete p.t0;\n\t\t\telse p.t1 = new Date(p.t0.valueOf() + 60000 * m);\n\t\t}\n\t});\n\tvar pf = _el('prog_filters');\n\tpf.onclick = KonOpas.Prog.filter_change;\n\tvar pl = pf.getElementsByClassName('popup-link');\n\tfor (var i = 0; i < pl.length; ++i) {\n\t\tpl[i].setAttribute('data-title', pl[i].textContent);\n\t\tpl[i].nextElementSibling.onclick = KonOpas.Prog.filter_change;\n\t}\n\tvar sf = _el('search');\n\tif (sf) {\n\t\tsf.onsubmit = _el('q').oninput = KonOpas.Prog.filter_change;\n\t\tsf.onreset = function() { KonOpas.Prog.set_filters({}); };\n\t}\n\tthis.init_filters(opt);\n\tvar pt = _el('tab_prog'),\n\t    pa = pt && pt.getElementsByTagName('a');\n\tif (pa && pa.length) pa[0].onclick = function(ev) {\n\t\tif (window.pageYOffset && document.body.classList.contains('prog')) {\n\t\t\twindow.scrollTo(0, 0);\n\t\t\t(ev || window.event).preventDefault();\n\t\t}\n\t};\n}\n\n\n// ------------------------------------------------------------------------------------------------ static\n\nKonOpas.Prog.hash = function(f, excl) {\n\tvar p = ['#prog'];\n\tif (f) ['id', 'area', 'tag', 'query'].forEach(function(k){\n\t\tvar v = f[k + '_str'] || f[k];\n\t\tif (excl && excl[k] || !v || (v == 'all_' + k + 's')) return;\n\t\tif ((k == 'tag') && konopas.tag_categories) {\n\t\t\tvar m = v.match(new RegExp('^(' + konopas.tag_categories.join('|') + '):(.*)'));\n\t\t\tif (m) { k = m[1]; v = m[2]; }\n\t\t}\n\t\tp.push(k + ':' + KonOpas.hash_encode(v));\n\t});\n\treturn p.length > 1 ? p.join('/') : '#';\n}\n\nKonOpas.Prog.get_filters = function(hash_only) {\n\tvar\tfilters = { 'area':'', 'tag':'', 'query':'', 'id':'' },\n\t\th = window.location.toString().split('#')[1] || '',\n\t\th_set = false,\n\t\ttag_re = konopas.tag_categories && konopas.tag_categories.length && new RegExp('^' + konopas.tag_categories.join('|') + '$');\n\tif (h.substr(0, 5) == 'prog/') {\n\t\th.substr(5).split('/').forEach(function(p){\n\t\t\tvar s = p.split(':');\n\t\t\tif ((s.length == 2) && s[0] && s[1]) {\n\t\t\t\tif (tag_re && tag_re.test(s[0])) {\n\t\t\t\t\ts[1] = p;\n\t\t\t\t\ts[0] = 'tag';\n\t\t\t\t}\n\t\t\t\tfilters[s[0]] = KonOpas.hash_decode(s[1]);\n\t\t\t\th_set = true;\n\t\t\t}\n\t\t});\n\t}\n\tif (!hash_only && !h_set && !document.body.classList.contains('prog')) {\n\t\tvar store = konopas.store.get('prog');\n\t\tif (store) for (var k in store) {\n\t\t\tif (filters.hasOwnProperty(k)) filters[k] = store[k];\n\t\t}\n\t}\n\treturn filters;\n}\n\nKonOpas.Prog.set_filters = function(f, silent) {\n\tif (silent && !(history && history.replaceState)) return false;\n\tif (f.id) f = { 'id': f.id };\n\tkonopas.store.set('prog', f);\n\tvar h = KonOpas.Prog.hash(f),\n\t    h_cur = window.location.toString().split('#')[1] || '';\n\tif (h_cur != h.substr(1)) {\n\t\tif (silent) {\n\t\t\tvar loc = window.location.toString().split('#')[0] + h;\n\t\t\thistory.replaceState({}, document.title, loc);\n\t\t\twindow.onhashchange()\n\t\t} else {\n\t\t\twindow.location.hash = h;\n\t\t}\n\t\treturn true;\n\t}\n\treturn false;\n}\n\n// read filters from url + ev -> set new hash\nKonOpas.Prog.filter_change = function(ev) {\n\tev = ev || window.event;\n\tvar key, value;\n\tvar silent = false;\n\tswitch (ev.type) {\n\t\tcase 'click':\n\t\t\tif (ev.target.tagName.toLowerCase() != 'li') return;\n\t\t\tvar popups = ev.target.getElementsByClassName('popup');\n\t\t\tif (popups && popups.length) return;\n\t\t\tkey = ev.target.parentNode.id.replace(/\\d+$/, '');\n\t\t\tvalue = ev.target.id;\n\t\t\tswitch (key) {\n\t\t\t\tcase 'area': value = value.replace(/^a([^a-zA-Z])/, '$1'); break;\n\t\t\t\tcase 'tag':  value = value.replace(/^t([^a-zA-Z])/, '$1'); break;\n\t\t\t}\n\t\t\tbreak;\n\t\tcase 'submit':\n\t\t\tev.preventDefault();\n\t\t\t// fallthrough\n\t\tcase 'input':\n\t\t\tkey = 'query';\n\t\t\tvalue = _el(\"q\").value;\n\t\t\tsilent = value.length > 1;\n\t\t\tbreak;\n\t\tdefault: return;\n\t}\n\tvar filters = KonOpas.Prog.get_filters();\n\tfilters[key] = value;\n\tif (filters['id'] && (key != 'id')) filters['id'] = '';\n\tKonOpas.Prog.set_filters(filters, silent);\n}\n\nKonOpas.Prog.focus_day = function(d) {\n\tfor (var n in {'day-sidebar':1, 'day-narrow':1}) {\n\t\tvar e = _el(n),\n\t\t\ts = e && e.getElementsByTagName('li');\n\t\tif (s) for (var i = 0; i < s.length; ++i) {\n\t\t\tvar _d = s[i].getAttribute('data-day');\n\t\t\ts[i].classList[(_d == d) ? 'add' : 'remove']('selected');\n\t\t}\n\t}\n}\n\n\n\n// ------------------------------------------------------------------------------------------------ instance\n\nKonOpas.Prog.prototype.init_filters = function(opt) {\n\tvar filter_el = _el('prog_lists'), labels = {}, regexp = {};\n\tfunction _txt(s) {\n\t\treturn i18n.txt(s.charAt(0).toUpperCase() + s.slice(1).replace('_',' '));\n\t}\n\tfunction _ul(id) {\n\t\tvar e = document.createElement('ul');\n\t\te.id = id;\n\t\treturn e;\n\t}\n\tfunction _li(par, id, txt) {\n\t\tvar e = document.createElement('li');\n\t\te.id = /^[^a-zA-Z]/.test(id) ? par.id[0] + id : id\n\t\tif (!txt) txt = labels[id] || _txt(id);\n\t\tif (/^\\s*$/.test(txt)) return;\n\t\te.textContent = /^[\\\\^$]/.test(txt) ? txt.substr(1) : txt;\n\t\tif (regexp[id]) e.setAttribute('data-regexp', regexp[id]);\n\t\tpar.appendChild(e);\n\t}\n\tfunction _compare(a, b) {\n\t\tvar sf = function(s) { return (labels[s] || s.replace(/^[^:]+:/, '')).toLowerCase().replace(/^the /, ''); },\n\t\t\taf = function(s) { return s.match(/\\d+|\\D+/g).map(function(v) { return Number(v) || v; }); },\n\t\t\t_a = sf(a), _b = sf(b);\n\t\tif ((_a[0] == '$') != (_b[0] == '$')) return (_a < _b) ? 1 : -1; // $ == 0x24\n\t\tif (/\\d/.test(_a) && /\\d/.test(_b)) {\n\t\t\tvar aa = af(_a), bb = af(_b);\n\t\t\tfor (var i = 0; i < aa.length && i < bb.length; ++i) {\n\t\t\t\tif (aa[i] < bb[i]) return -1;\n\t\t\t\tif (aa[i] > bb[i]) return  1;\n\t\t\t}\n\t\t\tif (aa.length != bb.length) return aa.length < bb.length ? -1 : 1;\n\t\t} else {\n\t\t\tif (_a < _b) return -1;\n\t\t\tif (_a > _b) return  1;\n\t\t}\n\t\treturn 0;\n\t}\n\tfunction _ul2(par, id, name, prefix, list) {\n\t\tvar title = labels[name] || _txt(name),\n\t\t    root = document.createElement('li'),\n\t\t    link = _new_elem('div', 'popup-link', title + ''),\n\t\t    ul = _new_elem('ul', 'popup');\n\t\tlink.setAttribute('data-title', link.textContent);\n\t\tlink.addEventListener('click', KonOpas.popup_open);\n\t\tul.id = id;\n\t\tul.setAttribute('data-title', title);\n\t\tul.addEventListener('click', KonOpas.Prog.filter_change);\n\t\tfor (var i = 0; i < list.length; ++i) {\n\t\t\tvar txt = labels[list[i]] || list[i].replace(prefix, '');\n\t\t\t_li(ul, list[i], txt);\n\t\t}\n\t\troot.appendChild(link);\n\t\troot.appendChild(ul);\n\t\tpar.appendChild(root);\n\t}\n\tfunction _fill(id, items) {\n\t\tvar i = 0, o = opt[id], ul = _ul(id);\n\t\tlabels = o.labels || {};\n\t\tregexp = o.regexp || {};\n\t\tfor (var r in regexp) items[r] = 1;\n\t\t_li(ul, 'all_' + id + 's');\n\t\tif (o.promote) for (i = 0; i < o.promote.length; ++i) {\n\t\t\t_li(ul, o.promote[i]);\n\t\t\tdelete items[o.promote[i]];\n\t\t}\n\t\tif (o.exclude) {\n\t\t\tvar re = new RegExp(o.exclude.join('|'));\n\t\t\tfor (var t in items) if (re.test(t)) delete items[t];\n\t\t}\n\t\tif (o.min_count) {\n\t\t\tfor (var t in items) if (items[t] < o.min_count) delete items[t];\n\t\t}\n\t\tvar list = Object.keys(items).sort(_compare);\n\t\tif (o.categories) for (i = 0; i < o.categories.length; ++i) {\n\t\t\tvar prefix = o.categories[i] + ':',\n\t\t\t    list_in = [], list_out = [];\n\t\t\tfor (var j = 0; j < list.length; ++j) {\n\t\t\t\tif (list[j].substr(0, prefix.length) == prefix) {\n\t\t\t\t\tlist_in.push(list[j]);\n\t\t\t\t} else {\n\t\t\t\t\tlist_out.push(list[j]);\n\t\t\t\t}\n\t\t\t}\n\t\t\tswitch (list_in.length) {\n\t\t\t\tcase 0:   break;\n\t\t\t\tcase 1:   _li(ul, prefix + list_in[0]);  break;\n\t\t\t\tdefault:  _ul2(ul, id + i, o.categories[i], prefix, list_in);\n\t\t\t}\n\t\t\tlist = list_out;\n\t\t}\n\t\tif (list.length < 4) for (i = 0; i < list.length; ++i) _li(ul, list[i]);\n\t\telse _ul2(ul, id + i, id, '', list);\n\t\tfilter_el.appendChild(ul);\n\t}\n\tif (!opt || !filter_el) return;\n\twhile (filter_el.firstChild) filter_el.removeChild(filter_el.firstChild);\n\tvar days = {}, areas = {}, tags = {},\n\t    lvl = (opt.area && opt.area.loc_level) || 0;\n\tfor (var i = 0, l = this.list.length; i < l; ++i) {\n\t\tvar p = this.list[i];\n\t\tif (p.date) days[p.date] = 1;\n\t\tif (opt.area && (typeof p.loc == 'object') && p.loc && p.loc[lvl]) areas[p.loc[lvl]] = (areas[p.loc[lvl]] || 0) + 1;\n\t\tif (opt.tag && (typeof p.tags == 'object') && p.tags) for (var j = 0; j < p.tags.length; ++j) {\n\t\t\tvar t_s = opt.tag.set_category && opt.tag.set_category[p.tags[j]];\n\t\t\tif (t_s) p.tags[j] = t_s + ':' + p.tags[j];\n\t\t\ttags[p.tags[j]] = (tags[p.tags[j]] || 0) + 1;\n\t\t}\n\t}\n\tif (opt.day && opt.day.exclude) {\n\t\tvar d_re = new RegExp(opt.day.exclude.join('|'));\n\t\tfor (var d in days) if (d_re.test(d)) delete days[d];\n\t}\n\tthis.days = {};\n\tfor (var d in days) {\n\t\tvar d_d = KonOpas.parse_date(d), d_n = {'N': d_d ? d_d.getDay() : -1 };\n\t\tthis.days[d] = {\n\t\t\t'short': i18n.txt('weekday_short_n', d_n),\n\t\t\t'long': i18n.txt('weekday_n', d_n)\n\t\t};\n\t}\n\tif (opt.area) _fill('area', areas);\n\tif (opt.tag) _fill('tag', tags);\n}\n\n\nKonOpas.Prog.prototype.show_filter_sum = function(ls, f) {\n\tvar fs = _el('filter_sum'); if (!fs) return;\n\tvar cb = _el('q_clear');\n\tvar _a = function(txt, unset) {\n\t\tvar excl = {id:1}; if (unset) excl[unset] = 1;\n\t\treturn '<a href=\"' + KonOpas.Prog.hash(f, excl) + '\">' + txt + '</a>';\n\t}\n\tif (f.id_only) {\n\t\tfs.innerHTML = i18n.txt('filter_sum_id', { 'N':ls.length, 'TITLE':_a(ls[0].title), 'ID':_a(f.id) });\n\t\tif (cb) cb.disabled = false;\n\t} else {\n\t\tvar d = { 'N': f.n_listed,\n\t\t\t'ALL': !f.show_all || f.tag_str || f.area_str || f.query_str ? '' : _a(i18n.txt('all'), {}, 0),\n\t\t\t'TAG': f.tag_str ? _a(f.tag_str, 'tag') : '' };\n\t\tif (f.day && !f.show_all) {\n\t\t\td['DAY'] = i18n.txt('weekday_n', {'N': KonOpas.parse_date(f.day).getDay() });\n\t\t\tif (f.n_hidden) d['TIME'] = KonOpas.pretty_time(f.now, konopas);\n\t\t} else {\n\t\t\tif (f.n_hidden) d['LIVE'] = true;\n\t\t}\n\t\tif (f.area_str) d['AREA'] = _a(f.area_str, 'area');\n\t\tif (f.query_str) d['Q'] = _a(f.query_str, 'query');\n\t\tfs.innerHTML = i18n.txt('filter_sum', d);\n\t\tif (cb) cb.disabled = !f.area_str && !f.tag_str && !f.query_str;\n\t}\n}\n\n// hashchange -> read filters from url + store -> set filters in html + store -> list items\nKonOpas.Prog.prototype.show = function() {\n\tfunction _show_filters(f) {\n\t\tvar prev = _el('prog_filters').getElementsByClassName('selected');\n\t\tif (prev) for (var i = prev.length - 1; i >= 0; --i) {\n\t\t\tvar cl = prev[i].classList;\n\t\t\tif (cl.contains('popup-link')) prev[i].textContent = prev[i].getAttribute('data-title') || i18n.txt('More') + '';\n\t\t\tcl.remove('selected');\n\t\t}\n\t\tfor (var k in f) {\n\t\t\tif (k == 'query') {\n\t\t\t\tvar q = _el(\"q\");\n\t\t\t\tif (q) {\n\t\t\t\t\tq.value = f.query;\n\t\t\t\t\tif (f.query) q.classList.add('selected');\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tvar id = f[k];\n\t\t\t\tif (!id) id = 'all_' + k + 's';\n\t\t\t\telse if (id.match(/^[^a-zA-Z]/)) id = k[0] + id;\n\t\t\t\tvar el = _el(id);\n\t\t\t\tif (el) {\n\t\t\t\t\tel.classList.add('selected');\n\t\t\t\t\tif (el.parentNode.id.match(/\\d+$/)) {\n\t\t\t\t\t\tvar p = el.parentNode.parentNode.firstChild;\n\t\t\t\t\t\tp.classList.add('selected');\n\t\t\t\t\t\tp.textContent = el.textContent;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tfunction _filter(it) {\n\t\tif (this.area) {\n\t\t\tif (this.area instanceof RegExp) {\n\t\t\t\tif (!this.area.test(it.loc.join(';'))) return false;\n\t\t\t} else {\n\t\t\t\tif (!it.loc || (it.loc.indexOf(this.area) < 0)) return false;\n\t\t\t}\n\t\t}\n\t\tif (this.tag) {\n\t\t\tif (this.tag instanceof RegExp) {\n\t\t\t\tif (!this.tag.test(it.title)) return false;\n\t\t\t} else {\n\t\t\t\tif (!it.tags || (it.tags.indexOf(this.tag) < 0)) return false;\n\t\t\t}\n\t\t}\n\t\tif (this.query) {\n\t\t\tvar found = this.query.test(it.title)\n\t\t\t\t|| this.query.test(it.desc)\n\t\t\t\t|| (it.loc && this.query.test(it.loc.join('\\t')))\n\t\t\t\t|| (it.tags && this.query.test(it.tags.join('\\t')))\n\t\t\t\t|| (it.people && it.people.some(function(p){ return this.query.test(p.name); }, this));\n\t\t\tif (!found) return false;\n\t\t}\n\t\treturn true;\n\t}\n\tfunction _show_list(f, self) {\n\t\tf.area_str = f.area || '';\n\t\tif (f.area && _el(f.area)) {\n\t\t\tvar t = _el(f.area).getAttribute(\"data-regexp\");\n\t\t\tif (t) f.area = new RegExp(t);\n\t\t}\n\t\tf.tag_str = f.tag || '';\n\t\tif (f.tag && _el(f.tag)) {\n\t\t\tvar t = _el(f.tag).getAttribute(\"data-regexp\");\n\t\t\tif (t) f.tag = new RegExp(t);\n\t\t}\n\t\tf.query_str = f.query || '';\n\t\tif (f.query) f.query = KonOpas.glob_to_re(f.query);\n\t\tf.id_only = !!f.id;\n\t\tif (f.id_only) for (var i in f) if ((i != 'id') && (i != 'id_only') && f[i]) {\n\t\t\tf.id_only = false;\n\t\t\tbreak;\n\t\t}\n\t\tvar ls = self.list.filter(f.id_only ? function(it){ return it.id == f.id; } : _filter, f);\n\t\tif (f.id && ls.every(function(p) { return p.id != f.id; })) {\n\t\t\tf.id = '';\n\t\t\tif (KonOpas.Prog.set_filters(f)) return;\n\t\t}\n\t\tf.hide_ended = true;\n\t\tf.prog_view = true;\n\t\tKonOpas.Item.show_list(ls, f);\n\t}\n\n\tvar f = KonOpas.Prog.get_filters();\n\tif (KonOpas.Prog.set_filters(f)) return;\n\t_show_filters(f);\n\tfor (var k in f) {\n\t\tif (!k || !f[k] || (f[k] == 'all_' + k + 's')) { delete f[k]; continue; }\n\t}\n\t_show_list(f, this);\n}\nKonOpas.Server = function(id, stars, opt) {\n\tthis.id = id;\n\tthis.stars = stars;\n\n\topt = opt || {};\n\tthis.host = opt.host ||  'https://konopas-server.appspot.com';\n\tthis.el_id = opt.el_id || 'server_connect';\n\tthis.err_el_id = opt.err_el_id || 'server_error';\n\ttry { this.store = localStorage; } catch (e) { this.store = new KonOpas.VarStore(); }\n\n\tthis.connected = false;\n\tthis.token = this.store.getItem('konopas.token') || false;\n\tthis.ical = this.store.getItem('konopas.'+this.id+'.ical_link') || false;\n\tthis.prog_data = {};\n\tthis.prog_server_mtime = 0;\n\tthis.el = document.getElementById(this.el_id);\n\tthis.err_el = false;\n\n\tthis.disconnect();\n\tif (this.stars) this.stars.server = this;\n\tif (this.el && this.id) this.exec('info');\n\telse _log(\"server init failed\", 'warn');\n\n\tvar m = /#server_error=(.+)/.exec(window.location.hash);\n\tif (m) this.error(decodeURIComponent(m[1].replace(/\\+/g, ' ')), window.location.href);\n}\n\nKonOpas.Server.prototype.disconnect = function() {\n\tthis.connected = false;\n\tif (this.el) this.el.innerHTML = '<div id=\"server_info\">' + i18n.txt('Not connected') + '</div>';\n\tdocument.body.classList.remove('logged-in');\n}\n\nKonOpas.Server.prototype.logout = function(ev) {\n\t_log('server logout');\n\tthis.exec('/logout');\n\t(ev || window.event).preventDefault();\n}\n\nKonOpas.Server.prototype.error = function(msg, url) {\n\t_log('server error ' + msg + ', url: ' + url, 'error');\n\tif (msg =='') {\n\t\tvar cmd = url.replace(this.host, '').replace('/' + this.id + '/', '');\n\t\tmsg = i18n.txt('server_cmd_fail', {'CMD':'<code>'+cmd+'</code>'});\n\t}\n\tif (!this.err_el) {\n\t\tvar el = document.createElement('div');\n\t\tel.id = this.err_el_id;\n\t\tel.title = i18n.txt('Click to close');\n\t\tel.onclick = function(ev) { this.err_el.style.display = 'none'; }.bind(this);\n\t\tdocument.body.appendChild(el);\n\t\tthis.err_el = el;\n\t}\n\tthis.err_el.innerHTML = '<div>' + i18n.txt('Server error') + ': <b>' + msg + '</b></div>';\n\tthis.err_el.style.display = 'block';\n\treturn true;\n}\n\nKonOpas.Server.prototype.onmessage = function(ev) {\n\tev = ev || window.event;\n\tif (ev.origin != this.host) {\n\t\t_log('Got an unexpected message from ' + ev.origin, 'error');\n\t\t_log(ev);\n\t\treturn;\n\t}\n\tvar self = this;\n\tJSON.parse(ev.data, function(k, v) {\n\t\tswitch (k) {\n\t\t\tcase 'ok':    self.cb_ok(v);      break;\n\t\t\tcase 'fail':  self.error('', v);  break;\n\t\t}\n\t});\n}\n\n\n\n// ------------------------------------------------------------------------------------------------ prog\n\nKonOpas.Server.prototype.prog_mtime = function() {\n\tvar mtime = this.prog_server_mtime;\n\tfor (var id in this.prog_data) {\n\t\tif (this.prog_data[id][1] > mtime) mtime = this.prog_data[id][1];\n\t}\n\treturn mtime;\n}\n\nKonOpas.Server.prototype.add_prog = function(id, add_star) {\n\tif (id instanceof Array) id = id.join(',');\n\t_log('server add_prog \"' + id + '\" ' + (add_star ? '1' : '0'));\n\tvar t = this.prog_mtime();\n\tthis.exec('prog'\n\t\t+ (add_star ? '?add=' : '?rm=') + id\n\t\t+ (t ? '&t=' + t : ''));\n}\n\nKonOpas.Server.prototype.set_prog = function(star_list) {\n\t_log('server set_prog \"' + star_list);\n\tvar t = this.prog_mtime();\n\tthis.exec('prog'\n\t\t+ '?set=' + star_list.join(',')\n\t\t+ (t ? '&t=' + t : ''));\n}\n\n\n\n// ------------------------------------------------------------------------------------------------ ical\n\nKonOpas.Server.prototype.show_ical_link = function(p_el) {\n\tvar html = '';\n\tif (!this.connected) {\n\t\thtml = i18n.txt('ical_login');\n\t} else if (this.ical) {\n\t\tif (typeof this.ical == 'string') {\n\t\t\thtml = i18n.txt('ical_link') + '<br><a href=\"' + this.ical + '\">' + this.ical + '</a>'\n\t\t\t\t+ '<br><span class=\"hint\">' + i18n.txt('ical_hint') + '</span>';\n\t\t} else {\n\t\t\thtml = i18n.txt('ical_make', {'A_TAG':'<a id=\"ical_link\" class=\"js-link\">'});\n\t\t}\n\t}\n\tif (p_el) p_el.innerHTML += '<p id=\"ical_text\">' + html;\n\telse {\n\t\tvar i_el = document.getElementById('ical_text');\n\t\tif (i_el) i_el.innerHTML = html;\n\t}\n\tvar a = document.getElementById('ical_link');\n\tif (a) {\n\t\ta.onclick = function() { this.exec('ical_link'); }.bind(this);\n\t}\n}\n\n\n\n// ------------------------------------------------------------------------------------------------ exec\n\nKonOpas.Server.prototype.url = function(cmd) {\n\tif (this.token) cmd += (cmd.indexOf('?') != -1 ? '&' : '?') + 'k=' + encodeURIComponent(this.token);\n\treturn this.host + (cmd[0] == '/' ? '' : '/' + this.id + '/') + cmd;\n}\n\n// based on https://github.com/IntoMethod/Lightweight-JSONP/blob/master/jsonp.js\nKonOpas.Server.prototype.exec = function(cmd) {\n\tvar script = document.createElement('script'),\n\t\tdone = false,\n\t\turl = this.url(cmd);\n\tscript.src = url;\n\tscript.async = true;\n\tscript.onerror = function(ev) { this.error('', (ev || window.event).target.src); }.bind(this);\n\n\tscript.onload = script.onreadystatechange = function() {\n\t\tif (!done && (!this.readyState || this.readyState === \"loaded\" || this.readyState === \"complete\")) {\n\t\t\tdone = true;\n\t\t\tscript.onload = script.onreadystatechange = null;\n\t\t\tif (script && script.parentNode) {\n\t\t\t\tscript.parentNode.removeChild(script);\n\t\t\t}\n\t\t}\n\t};\n\tdocument.getElementsByTagName('head')[0].appendChild(script);\n}\n\n\n\n// ------------------------------------------------------------------------------------------------ cb ok/fail\n\n// callback for successful logout, prog\nKonOpas.Server.prototype.cb_ok = function(v) {\n\tvar m = /^(?:https?:\\/\\/[^\\/]+)?\\/?([^?\\/]*)(?:\\/([^?]*))(?:\\?(.*))?/.exec(v);\n\tvar cmd = m[2] || '';\n\tvar query = m[3] || '';\n\tswitch (cmd) {\n\t\tcase 'logout':\n\t\t\tthis.disconnect();\n\t\t\tthis.token = false;\n\t\t\tthis.store.setItem('konopas.token', '');\n\t\t\tthis.prog_data = {};\n\t\t\tthis.prog_server_mtime = 0;\n\t\t\tif (this.stars) {\n\t\t\t\tthis.stars.data = {};\n\t\t\t\tthis.stars.write();\n\t\t\t\tkonopas.set_view();\n\t\t\t}\n\t\t\tthis.exec('info');\n\t\t\t_log(\"server ok (logout): \" + JSON.stringify(v));\n\t\t\tbreak;\n\n\t\tcase 'prog':\n\t\t\tvar t = /&server_mtime=(\\d+)/.exec(query);\n\t\t\tif (t) this.prog_server_mtime = parseInt(t[1], 10);\n\t\t\t_log(\"server ok (prog): \" + JSON.stringify(v));\n\t\t\tbreak;\n\n\t\tdefault:\n\t\t\t_log(\"server ok (???): \" + JSON.stringify(v), 'warn');\n\t}\n}\n\n// callback for reporting server errors\nKonOpas.Server.prototype.cb_fail = function(v) {\n\tthis.error(v.msg, v.url);\n}\n\n\n\n// ------------------------------------------------------------------------------------------------ callback\n\nKonOpas.Server.prototype.cb_info = function(v) {\n\t_log(\"server info: \" + JSON.stringify(v));\n\tthis.connected = [v.name, v.email];\n\tthis.el.innerHTML = '<div id=\"server_info\">'\n\t                  + '<a id=\"server_logout\" href=\"' + this.url(v.logout) + '\">' + i18n.txt('Logout') + '</a> '\n\t                  + '<span id=\"server_user\" title=\"' + ((v.name != v.email) ? v.email : '') + '\">' + v.name.replace(/@.*/, '')\n\t                  + '</span></div>';\n\tif (v.ical) {\n\t\tthis.ical = this.ical || true;\n\t\tthis.show_ical_link(false);\n\t}\n\tdocument.getElementById('server_logout').onclick = this.logout.bind(this);\n\tdocument.body.classList.add('logged-in');\n\tif (typeof jsErrLog == 'object') jsErrLog.info = v.name.replace(/[ @].*/, '');\n}\n\nKonOpas.Server.prototype.cb_token = function(token) {\n\t_log(\"server token: \" + token);\n\tthis.token = token;\n\tthis.store.setItem('konopas.token', token);\n}\n\nKonOpas.Server.prototype.cb_login = function(v) {\n\t_log(\"server login: \" + JSON.stringify(v));\n\tvar links = [];\n\tfor (var cmd in v) {\n\t\tlinks.push('<a href=\"' + this.url(cmd) + '\">' + v[cmd] + '</a>');\n\t}\n\tthis.el.innerHTML = '<div id=\"login-links\">'\n\t\t+ '\\n&raquo; <span class=\"popup-link\" id=\"login-popup-link\">' + i18n.txt('Login to sync your data') + '</span>\\n'\n\t\t+ '<div class=\"popup\" id=\"login-popup\">' + i18n.txt('login_why')\n\t\t+ \"\\n<ul>\\n<li>\" + links.join(\"\\n<li>\")\n\t\t+ \"\\n</ul></div></div>\";\n\t_el('login-popup-link').onclick = KonOpas.popup_open;\n}\n\nKonOpas.Server.prototype.cb_my_prog = function(v) {\n\t_log(\"server my_prog: \" + JSON.stringify(v));\n\tthis.prog_data = v.prog;\n\tif (v.t0) for (var id in this.prog_data) { this.prog_data[id][1] += v.t0; }\n\tif (this.stars) this.stars.sync(this.prog_data);\n\telse _log(\"Server.stars required for prog sync\", 'warn');\n}\n\nKonOpas.Server.prototype.cb_my_votes = function(v) { /* obsolete */ }\nKonOpas.Server.prototype.cb_pub_data = function(p) { /* obsolete */ }\nKonOpas.Server.prototype.cb_show_comments = function(id, c) { /* obsolete */ }\n\nKonOpas.Server.prototype.cb_ical_link = function(url) {\n\tthis.ical = url;\n\tthis.store.setItem('konopas.'+this.id+'.ical_link', url);\n\tthis.show_ical_link(false);\n}\nKonOpas.Stars = function(id, opt) {\n\topt = opt || {};\n\tthis.name = 'konopas.' + id + '.stars';\n\ttry { this.store = localStorage || sessionStorage || (new KonOpas.VarStore()); }\n\tcatch (e) { this.store = new KonOpas.VarStore(); }\n\tthis.tag = opt.tag || 'has_star';\n\tthis.server = false;\n\tthis.data = this.read();\n}\n\nKonOpas.Stars.prototype.read = function() {\n\treturn JSON.parse(this.store && this.store.getItem(this.name) || '{}');\n}\n\nKonOpas.Stars.prototype.write = function() {\n\ttry {\n\t\tif (this.store) this.store.setItem(this.name, JSON.stringify(this.data));\n\t} catch (e) {\n\t\tif ((e.code != DOMException.QUOTA_EXCEEDED_ERR) || (this.store.length != 0)) { throw e; }\n\t}\n}\n\nKonOpas.Stars.prototype.list = function() {\n\tvar list = [];\n\tif (this.data) for (var id in this.data) {\n\t\tif ((this.data[id].length == 2) && this.data[id][0]) list.push(id);\n\t}\n\treturn list;\n}\n\nKonOpas.Stars.prototype.add = function(star_list, mtime) {\n\tmtime = mtime || Math.floor(Date.now()/1000);\n\tstar_list.forEach(function(id) { this.data[id] = [1, mtime]; }, this);\n\n\tthis.write();\n\tif (this.server) this.server.set_prog(this.list());\n}\n\nKonOpas.Stars.prototype.set = function(star_list) {\n\tvar mtime = Math.floor(Date.now()/1000);\n\tif (this.data) for (var id in this.data) {\n\t\tthis.data[id] = [0, mtime];\n\t}\n\tthis.add(star_list, mtime);\n}\n\nKonOpas.Stars.prototype.toggle = function(el, id) {\n\tvar add_star = !el.classList.contains(this.tag);\n\tvar mtime = Math.floor(Date.now()/1000);\n\n\tthis.data[id] = [add_star ? 1 : 0, mtime];\n\tthis.write();\n\tif (this.server) this.server.add_prog(id, add_star);\n\n\tif (add_star) el.classList.add(this.tag);\n\telse          el.classList.remove(this.tag);\n}\n\nKonOpas.Stars.prototype.sync = function(new_data) {\n\tvar local_mod = [], redraw = false;\n\tfor (var id in new_data) {\n\t\tif (new_data[id].length != 2) {\n\t\t\t_log('Stars.sync: invalid input ' + id + ': ' + JSON.stringify(new_data[id]), 'warn');\n\t\t\tcontinue;\n\t\t}\n\t\tif (!(id in this.data) || (new_data[id][1] > this.data[id][1])) {\n\t\t\tlocal_mod.push(id);\n\t\t\tif (!(id in this.data) || (new_data[id][0] != this.data[id][0])) redraw = true;\n\t\t\tthis.data[id] = new_data[id];\n\t\t}\n\t}\n\tif (local_mod.length) {\n\t\t_log('Stars.sync: local changes: ' + local_mod + (redraw ? ' -> redraw' : ''));\n\t\tthis.write();\n\t\tif (redraw) konopas.set_view();\n\t}\n\n\tif (this.server) {\n\t\tvar server_add = [], server_rm = [];\n\t\tfor (var id in this.data) {\n\t\t\tif (!(id in new_data) || (new_data[id][1] < this.data[id][1])) {\n\t\t\t\tif (this.data[id][0]) server_add.push(id);\n\t\t\t\telse                  server_rm.push(id);\n\t\t\t}\n\t\t}\n\t\tif (server_add.length) {\n\t\t\t_log('Stars.sync: server add: ' + server_add);\n\t\t\tthis.server.add_prog(server_add, true);\n\t\t}\n\t\tif (server_rm.length) {\n\t\t\t_log('Stars.sync: server rm: ' + server_rm);\n\t\t\tthis.server.add_prog(server_rm, false);\n\t\t}\n\n\t\tif (!local_mod.length && !server_add.length && !server_rm.length) {\n\t\t\t_log('Stars.sync: no changes');\n\t\t}\n\t}\n}\n\nKonOpas.Stars.prototype.show = function() {\n\tvar view = _el(\"star_data\"),\n\t\thash = window.location.hash.substr(6),\n\t    set_raw = (hash && (hash.substr(0,4) == 'set:')) ? hash.substr(4).split(',') : [],\n\t    set = konopas.program.list.filter(function(p) { return (set_raw.indexOf(p.id) >= 0); }).map(function(p) { return p.id; }),\n\t    set_len = set.length,\n\t    html = '',\n\t    star_list = this.list(),\n\t    stars_len = star_list.length;\n\tif (konopas.store.limit && (!this.server || !this.server.connected)) {\n\t\thtml = '<p>' + i18n.txt('star_no_memory', {'WHY': konopas.store.limit, 'SERVER': !!this.server});\n\t}\n\tif (!stars_len && !set_len) {\n\t\t_el(\"prog_ls\").innerHTML = '';\n\t\tview.innerHTML = html + '<p>' + i18n.txt('star_hint');\n\t\treturn;\n\t}\n\tdocument.body.classList.remove(\"show_set\");\n\tset.sort();\n\tstar_list.sort();\n\tvar set_link = '#star/set:' + star_list.join(',');\n\tif (set_len) {\n\t\tif (KonOpas.arrays_equal(set, star_list)) {\n\t\t\thtml += '<p>' + i18n.txt('star_export_this', { 'THIS':set_link }) + '<p>' +\n\t\t\t\ti18n.txt('star_export_share', {\n\t\t\t\t\t'SHORT': KonOpas.link_to_short_url(location.href),\n\t\t\t\t\t'QR': KonOpas.link_to_qr_code(location.href)\n\t\t\t\t});\n\t\t} else {\n\t\t\tdocument.body.classList.add(\"show_set\");\n\t\t\tvar n_same = KonOpas.array_overlap(set, star_list);\n\t\t\tvar n_new = set_len - n_same;\n\t\t\tvar n_bad = set_raw.length - set_len;\n\t\t\thtml += '<p>' + i18n.txt('star_import_this', {'THIS':location.href})\n\t\t\t\t+ '<p>' + i18n.txt('star_import_diff', { 'PREV':stars_len, 'NEW':n_new, 'SAME':n_same });\n\t\t\tif (n_bad) html += ' ' + i18n.txt('star_import_bad', {'BAD':n_bad});\n\t\t\tif (!stars_len || (n_same != stars_len)) {\n\t\t\t\thtml += '<p>&raquo; <a href=\"#star\" id=\"star_set_set\">' + i18n.txt('star_set') + '</a>';\n\t\t\t}\n\t\t\tif (stars_len) {\n\t\t\t\tif (n_same != stars_len) {\n\t\t\t\t\tvar d = [];\n\t\t\t\t\tif (n_new) d.push(i18n.txt('add_n', {'N':n_new}));\n\t\t\t\t\td.push(i18n.txt('discard_n', {'N':stars_len - n_same}));\n\t\t\t\t\thtml += ' (' + d.join(', ') + ')';\n\t\t\t\t}\n\t\t\t\tif (n_new) html += '<p>&raquo; <a href=\"#star\" id=\"star_set_add\">' + i18n.txt('star_add', {'N':n_new}) + '</a>';\n\t\t\t}\n\t\t}\n\t} else {\n\t\thtml += '<p id=\"star_links\">&raquo; ' + i18n.txt('star_export_link', { 'URL':set_link, 'N':stars_len });\n\t}\n\tview.innerHTML = html;\n\tvar el_set = _el('star_set_set'); if (el_set) el_set.onclick = function() { konopas.stars.set(set); return true; };\n\tvar el_add = _el('star_set_add'); if (el_add) el_add.onclick = function() { konopas.stars.add(set); return true; };\n\tif (this.server) this.server.show_ical_link(view);\n\tvar ls = konopas.program.list.filter(function(it) { return (star_list.indexOf(it.id) >= 0) || (set.indexOf(it.id) >= 0); });\n\tKonOpas.Item.show_list(ls, {hide_ended:true});\n\tif (set_len) for (var i = 0; i < set_len; ++i) {\n\t\tvar el = _el('s' + set[i]);\n\t\tif (el) el.classList.add(\"in_set\");\n\t}\n}\nif (typeof i18n == 'undefined') i18n = {};\ni18n.txt = function(key){ return key; };\ni18n.translate_html = function(map, a) {\n\tvar list = document.querySelectorAll('['+a+']');\n\tfor (var i = 0, node; node = list[i]; ++i) {\n\t\tvar key = node.getAttribute(a) || node.textContent.trim();\n\t\tif (key in map) {\n\t\t\tvar data = node.getAttribute(a + '-var');\n\t\t\tvar attr = node.getAttribute(a + '-attr');\n\t\t\tvar str = map[key](data && JSON.parse('{' + data.replace(/[^,:]+/g, '\"$&\"') + '}'));\n\t\t\tif (attr) node.setAttribute(attr, str);\n\t\t\telse node.innerHTML = str;\n\t\t}\n\t}\n}\n\nfunction _log(msg, lvl) {\n\tif (window.console) switch (lvl) {\n\t\tcase 'error': console.error(msg); break;\n\t\tcase 'warn':  console.warn(msg); break;\n\t\tdefault:      console.log(msg);\n\t}\n}\n\nfunction _el(id) { return id && document.getElementById(id); }\n\nfunction _new_elem(tag, cl, text, hide) {\n\tvar e = document.createElement(tag);\n\tif (cl) e.className = cl;\n\tif (text) e.textContent = text;\n\tif (hide) e.style.display = 'none';\n\treturn e;\n}\n\nKonOpas.link_to_short_url = function(url) {\n\tvar u = encodeURIComponent(url.replace(/^http:\\/\\//, ''));\n\treturn 'http://is.gd/create.php?url=' + u;\n}\nKonOpas.link_to_qr_code = function(url) {\n\tvar u = encodeURIComponent(url.replace(/^http:\\/\\//, ''));\n\treturn 'http://chart.apis.google.com/chart?cht=qr&chs=350x350&chl=' + u;\n}\n\nKonOpas.hash_encode = function(s) { return encodeURIComponent(s).replace(/%20/g, '+'); }\nKonOpas.hash_decode = function(s) { return decodeURIComponent(s.replace(/\\+/g, '%20')); }\n\nKonOpas.glob_to_re = function(pat) {\n\tvar re_re = new RegExp('[.\\\\\\\\+*?\\\\[\\\\^\\\\]$(){}=!<>|:\\\\/-]', 'g');\n\tpat = pat.replace(re_re, '\\\\$&').replace(/\\\\\\*/g, '.*').replace(/\\\\\\?/g, '.');\n\tvar terms = pat.match(/\"[^\"]*\"|'[^']*'|\\S+/g).map(function(el){\n\t\treturn '\\\\b' + el.replace(/^(['\"])(.*)\\1$/, '$2\\\\b');\n\t});\n\treturn new RegExp(terms.join('|'), 'i');\n}\n\n\n// ------------------------------------------------------------------------------------------------ storage\n\nKonOpas.Store = function(id) {\n\ttry {\n\t\tsessionStorage.setItem('konopas.test_var', '1');\n\t\tsessionStorage.removeItem('konopas.test_var', '1');\n\t\tthis.get = function(k) {\n\t\t\tvar v = sessionStorage.getItem('konopas.' + id + '.' + k);\n\t\t\treturn v ? JSON.parse(v) : v;\n\t\t}\n\t\tthis.set = function(k, v) {\n\t\t\tsessionStorage.setItem('konopas.' + id + '.' + k, JSON.stringify(v));\n\t\t}\n\t\tthis.limit = '';\n\t} catch (e) {\n\t\tvar data = {};\n\t\tthis.get = function(k) { return data[k]; };\n\t\tthis.set = function(k, v) { data[k] = v; };\n\t\tthis.limit = (e.name == 'SecurityError') ? 'FFcookies'\n\t\t\t\t   : ((e.code === DOMException.QUOTA_EXCEEDED_ERR) && (sessionStorage.length === 0)) ? 'IOSprivate'\n\t\t\t\t   : '?';\n\t}\n}\n\nKonOpas.VarStore = function() {\n\tvar data = {};\n\tthis.getItem = function(k) { return data[k]; };\n\tthis.setItem = function(k, v) { data[k] = v; };\n}\n\n\n// ------------------------------------------------------------------------------------------------ string generation\n\nKonOpas.clean_name = function(p, span_parts) {\n\tvar fn = '', ln = '';\n\tswitch (p.name.length) {\n\t\tcase 1:\n\t\t\tln = p.name[0];\n\t\t\tbreak;\n\t\tcase 2:\n\t\t\tif (p.name[1]) {\n\t\t\t\tfn = p.name[0];\n\t\t\t\tln = p.name[1];\n\t\t\t} else {\n\t\t\t\tln = p.name[0];\n\t\t\t}\n\t\t\tbreak;\n\t\tcase 3:\n\t\t\tfn = p.name[2] + ' ' + p.name[0];\n\t\t\tln = p.name[1];\n\t\t\tbreak;\n\t\tcase 4:\n\t\t\tfn = p.name[2] + ' ' + p.name[0];\n\t\t\tln = p.name[1] + (p.name[3] ? ', ' + p.name[3] : '');\n\t\t\tbreak;\n\t}\n\treturn span_parts\n\t\t? '<span class=\"fn\">' + fn.trim() + '</span> <span class=\"ln\">' + ln.trim() + '</span>'\n\t\t: (fn + ' ' + ln).trim();\n}\n\nKonOpas.clean_links = function(p) {\n\tvar ok = false, o = {};\n\tif (p && ('links' in p)) {\n\t\tif (p.links.img || p.links.photo) {\n\t\t\tvar img = (p.links.img || p.links.photo).trim();\n\t\t\tif (/^www/.test(img)) img = 'http://' + img;\n\t\t\tif (/:\\/\\//.test(img)) { o['img'] = { 'tgt': img }; ok = true; }\n\t\t}\n\t\tif (p.links.url) {\n\t\t\tvar url = p.links.url.trim();\n\t\t\tif (!/:\\/\\//.test(url)) url = 'http://' + url;\n\t\t\to['URL'] = { 'tgt': url, 'txt': url.replace(/^https?:\\/\\//, '') };\n\t\t\tok = true;\n\t\t}\n\t\tif (p.links.fb) {\n\t\t\tvar fb = p.links.fb.trim().replace(/^(https?:\\/\\/)?(www\\.)?facebook.com(\\/#!)?\\//, '');\n\t\t\to['Facebook'] = { 'txt': fb };\n\t\t\tif (/[^a-zA-Z0-9.]/.test(fb) && !/^pages\\//.test(fb)) fb = 'search.php?q=' + encodeURI(fb).replace(/%20/g, '+');\n\t\t\to['Facebook']['tgt'] = 'https://www.facebook.com/' + fb;\n\t\t\tok = true;\n\t\t}\n\t\tif (p.links.twitter) {\n\t\t\tvar tw = p.links.twitter.trim().replace(/[@]/g, '').replace(/^(https?:\\/\\/)?(www\\.)?twitter.com(\\/#!)?\\//, '');\n\t\t\to['Twitter'] = { 'txt': '@' + tw };\n\t\t\tif (/[^a-zA-Z0-9_]/.test(tw)) tw = 'search/users?q=' + encodeURI(tw).replace(/%20/g, '+');\n\t\t\to['Twitter']['tgt'] = 'https://www.twitter.com/' + tw;\n\t\t\tok = true;\n\t\t}\n\t}\n\treturn ok ? o : false;\n}\n\n\n// ------------------------------------------------------------------------------------------------ array comparison\n\nKonOpas.arrays_equal = function(a, b) {\n\tif (!a || !b) return false;\n\tif (a.length != b.length) return false;\n\tfor (var i = 0; i < a.length; ++i) {\n\t\tif (a[i] != b[i]) return false;\n\t}\n\treturn true;\n}\n\nKonOpas.array_overlap = function(a, b) {\n\tif (!a || !b) return 0;\n\tif (a.length > b.length) return KonOpas.array_overlap(b, a);\n\tvar n = 0, i, j;\n\tfor (i = 0; i < a.length; ++i) {\n\t\tfor (j = 0; j < b.length; ++j) if (a[i] == b[j]) { ++n; break; }\n\t}\n\treturn n;\n}\n\n\n// ------------------------------------------------------------------------------------------------ DOM manipulation\n\nKonOpas.popup_open = function(ev) {\n\tev = ev || window.event;\n\tif (ev.which != 1) return;\n\tvar src_el = ev.target, pop_el = src_el.nextElementSibling;\n\tif (!pop_el || !pop_el.classList.contains('popup')) {\n\t\tif (src_el.href && /\\.(gif|jpe?g|png)$/i.test(src_el.href)) {\n\t\t\tpop_el = _new_elem('img', 'popup');\n\t\t\tpop_el.src = src_el.href;\n\t\t\tsrc_el.parentNode.insertBefore(pop_el, src_el.nextSibling);\n\t\t} else return;\n\t}\n\tvar wrap_el = _new_elem('div', 'popup-wrap');\n\twrap_el.onclick = function() {\n\t\tpop_el.parentNode.removeChild(pop_el);\n\t\twrap_el.parentNode.removeChild(wrap_el);\n\t\tsrc_el.parentNode.insertBefore(pop_el, src_el.nextSibling);\n\t};\n\tvar pop_title = pop_el.getAttribute('data-title') || '';\n\tif (pop_title) wrap_el.appendChild(_new_elem('div', 'popup-title', pop_title));\n\tpop_el.parentNode.removeChild(pop_el);\n\twrap_el.appendChild(pop_el);\n\tdocument.body.appendChild(wrap_el);\n\tif (src_el.href) ev.preventDefault();\n}\n\nKonOpas.toggle_collapse = function(ev) {\n\tev = ev || window.event;\n\tvar title = ev.target, body = title && title.nextElementSibling;\n\tif (!body) return;\n\tif (window.getComputedStyle(body).getPropertyValue('display') == 'none') {\n\t\ttitle.classList.remove('collapse');\n\t\ttitle.classList.add('collapse-open');\n\t} else {\n\t\ttitle.classList.add('collapse');\n\t\ttitle.classList.remove('collapse-open');\n\t}\n}\n\n\n// ------------------------------------------------------------------------------------------------ time & date\n\nKonOpas.pretty_time = function(t, opt) {\n\tfunction pre0(n) { return (n < 10 ? '0' : '') + n; }\n\tfunction _pretty_time(h, m) {\n\t\tif (opt.time_show_am_pm) {\n\t\t\tvar h12 = h % 12; if (h12 == 0) h12 = 12;\n\t\t\tvar m_str = ((m == 0) && opt.abbrev_00_minutes ) ? '' : ':' + pre0(m);\n\t\t\treturn h12 + m_str + (h < 12 ? 'am' : 'pm');\n\t\t} else {\n\t\t\treturn pre0(h) + ':' + pre0(m);\n\t\t}\n\t}\n\topt = opt || {};\n\tif (t instanceof Date) {\n\t\treturn _pretty_time(t.getHours(), t.getMinutes());\n\t} else if (typeof t == 'string' || t instanceof String) {\n\t\tif (opt.time_show_am_pm) {\n\t\t\tvar a = t.split(':'); // hh:mm\n\t\t\treturn _pretty_time(parseInt(a[0], 10), parseInt(a[1], 10));\n\t\t} else return t;\n\t} else return '';\n}\n\nKonOpas.pretty_time_diff = function(t) {\n\tvar d = (Date.now() - t) / 1e3,\n\t    a = Math.abs(d),\n\t    s = [1, 60, 60, 24, 7, 4.333, 12, 1e9];\n\tif (a < 20) return i18n.txt('just now');\n\tfor (var i = 0, l = s.length; i < l; ++i) {\n\t\tif ((a /= s[i]) < 2) return i18n.txt('time_diff', { 'T':~~(a *= s[i]), 'T_UNIT':i-1, 'T_PAST':d>0 });\n\t}\n}\n\nKonOpas.parse_date = function(day_str) {\n\tif (!day_str) return false;\n\tvar a = day_str.match(/(\\d+)/g); if (!a || (a.length < 3)) return false;\n\tvar y = parseInt(a[0], 10), m = parseInt(a[1], 10), d = parseInt(a[2], 10);\n\tif (!y || !m || !d) return false;\n\treturn new Date(y, m - 1, d, 12);\n}\n\nKonOpas.data_date = function(d) {\n\tfunction pre0(n) { return (n < 10 ? '0' : '') + n; }\n\tvar t = (d instanceof Date) ? d : KonOpas.parse_date(d);\n\treturn t.getFullYear() + '-' + pre0(t.getMonth() + 1) + '-' + pre0(t.getDate());\n}\n\nKonOpas.pretty_date = function(d, opt) {\n\topt = opt || {};\n\tvar o = { weekday: \"long\", month: \"long\", day: \"numeric\" },\n\t    t = (d instanceof Date) ? d : KonOpas.parse_date(d);\n\tif (!t) return d;\n\tif (Math.abs(t - Date.now()) > 1000*3600*24*60) o.year = \"numeric\";\n\tvar s = t.toLocaleDateString(opt.lc, o);\n\treturn s.charAt(0).toUpperCase() + s.slice(1);\n}\n\nKonOpas.time_sum = function(t0_str, m_str) {\n\tvar t = 60 * t0_str.substr(0,2) + 1 * t0_str.substr(3,2) + 1 * m_str,\n\t    h = (t / 60) >> 0,\n\t    m = t - 60 * h;\n\treturn '' + (h % 24) + ':' + (m<10?'0':'') + m;\n}\n"]}